function repeatStartCompare(e,a){var n="",l="";return(n=""!=e.rec_id?e.rec_id.parseComnpactISO8601():e.start?new Date(e.start.getTime()):e.end?new Date(e.end.getTime()):1/0)<(l=""!=a.rec_id?a.rec_id.parseComnpactISO8601():a.start?new Date(a.start.getTime()):a.end?new Date(a.end.getTime()):1/0)?-1:n>l?1:0}function findWeek(e,a,n){var l=(n+7-a.getDay())%7,r=new Date(a.getTime());if(r.setDate(r.getDate()+l),r.getWeekNo()<=e)r.setDate(r.getDate()+7*(e-r.getWeekNo()));else{var t=new Date(r.getFullYear(),11,31,1,1,1).getWeekNo();r.setDate(r.getDate()+7*(t-r.getWeekNo()))}}function setAlertTimeouts(e,a,n,l,r,t,s){var d=new Array;if(e&&""!=l?n="string"==typeof l?l:new Date(l.getTime()):e&&""!=n&&(l="string"==typeof n?n:new Date(n.getTime())),a.length>0)for(var c=0;c<a.length;c++)if("-"==a[c].charAt(0)||"+"==a[c].charAt(0)||t){var p,i="";if(""==n&&""==l||"-"!=a[c].charAt(0))if(""==n&&""==l||"+"!=a[c].charAt(0)){if(t){if(i=$.fullCalendar.parseDate(a[c]),e)var o=""==l?n:l;else o=n;p=""!=o?new Date(o.getTime()):""}}else p="string"==typeof l?$.fullCalendar.parseDate(l):new Date(l.getTime()),i=p.getTime()+parseInt(a[c].substring(1,a[c].length-1));else p="string"==typeof n?$.fullCalendar.parseDate(n):new Date(n.getTime()),i=p.getTime()-parseInt(a[c].substring(1,a[c].length-1));var v=new Date;if(""!==i&&i>v){var u=i-v;maxAlarmValue<u&&(u=maxAlarmValue),d[d.length]=e?setTimeout(function(e){showAlertTODO(s,i-v,{start:""!=e?new Date(e.getTime()):"",status:r.status,title:r.title})},u,p):setTimeout(function(e){showAlertEvents(s,i-v,{start:new Date(e.getTime()),allDay:r.allDay,title:r.title})},u,p)}}return d}function isInRecurrenceArray(e,a,n,l){var r=!1;if("string"==typeof e?$.fullCalendar.parseDate(e):new Date(e.getTime()),n.length>0)for(var t=0;t<n.length;t++){var s=n[t].split(";")[0];if("Z"==s.charAt(s.length-1)){if(globalSettings.timezonesupport.value&&l in timezones){var d=getOffsetByTZ(l,e),c=new Date(s.parseComnpactISO8601().getTime());if(d){var p=1e3*d.getSecondsFromOffset();c.setTime(c.getTime()+p)}c.toString()+n[t].split(";")[1]==e+a&&(r=!0)}}else s.parseComnpactISO8601().toString()+n[t].split(";")[1]==e+a&&(r=!0)}return r}function applyTimezone(e,a){updateMainLoaderTextTimezone(),$("#MainLoader").show();for(var n=!1,l=!1,r=globalResourceCalDAVList.collections,t=globalResourceCalDAVList.TodoCollections,s=0,d=0,c=0,p=0,i=0;i<r.length;i++)null!=r[i].uid&&s++;for(i=0;i<t.length;i++)null!=t[i].uid&&c++;var o=globalEventList.displayEventsArray,v=globalEventList.displayTodosArray;for(i=0;i<r.length;i++)null!=r[i].uid&&setTimeout(function(t){for(var c=0;c<o[r[t].uid].length;c++)if("local"!=o[r[t].uid][c].timeZone&&!o[r[t].uid][c].allDay){var p=o[r[t].uid][c].start,i=getOffsetByTZ(e,p).getSecondsFromOffset(),v="";if(v="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,p).getSecondsFromOffset():60*p.getTimezoneOffset()*-1,void 0!==a&&(v=getOffsetByTZ(o[r[t].uid][c].timeZone,p).getSecondsFromOffset()),void 0===a||a)u=1e3*(v-i);else var u=1e3*(i-v);o[r[t].uid][c].start.setTime(o[r[t].uid][c].start.getTime()+u),o[r[t].uid][c].end&&o[r[t].uid][c].end.setTime(o[r[t].uid][c].end.getTime()+u);var m=o[r[t].uid][c];if((0==c||c>0&&o[r[t].uid][c].id!=o[r[t].uid][c-1].id)&&m.alertTime.length>0){for(var g=0;g<m.alertTimeOut.length;g++)clearTimeout(m.alertTimeOut[g]);for(var _="",f=new Date,C=0;C<m.alertTime.length;C++){if(null!=o[r[t].uid][c].start&&"-"==m.alertTime[C].charAt(0))_=o[r[t].uid][c].start.getTime()-parseInt(m.alertTime[C].substring(1,m.alertTime[C].length-1));else if(null!=o[r[t].uid][c].end&&"+"==m.alertTime[C].charAt(0))_=o[r[t].uid][c].end.getTime()+parseInt(m.alertTime[C].substring(1,m.alertTime[C].length-1));else{i=getOffsetByTZ(e,$.fullCalendar.parseDate(m.alertTime[C])).getSecondsFromOffset(),v="";if(v="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,$.fullCalendar.parseDate(m.alertTime[C])).getSecondsFromOffset():60*$.fullCalendar.parseDate(m.alertTime[C]).getTimezoneOffset()*-1,void 0!==a&&(v=getOffsetByTZ(o[r[t].uid][c].timeZone,$.fullCalendar.parseDate(m.alertTime[C])).getSecondsFromOffset()),void 0===a||a)u=1e3*(v-i);else var u=1e3*(i-v);_=new Date($.fullCalendar.parseDate(m.alertTime[C]).getTime()+u),o[r[t].uid][c].alertTime[C]=$.fullCalendar.formatDate(_,"yyyy-MM-dd HH:mm:ss")}if(_>f){var T=_-f;maxAlarmValue<T&&(T=maxAlarmValue),o[r[t].uid][c].alertTimeOut[C]=setTimeout(function(){showAlertEvents(m.id,_-f,{start:m.start,allDay:m.allDay,title:m.title})},T)}}}}++d==s&&(refetchCalendarEvents(),n=!0,l&&$("#MainLoader").hide())},10,i);for(i=0;i<t.length;i++)null!=t[i].uid&&setTimeout(function(r){for(var s=0;s<v[t[r].uid].length;s++){if(v[t[r].uid][s].start){"string"==typeof v[t[r].uid][s].start&&(v[t[r].uid][s].start=$.fullCalendar.parseDate(v[t[r].uid][s].start));var d=v[t[r].uid][s].start,i=getOffsetByTZ(e,d).getSecondsFromOffset(),o="",u=1e3*((o="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,d).getSecondsFromOffset():60*d.getTimezoneOffset()*-1)-i);v[t[r].uid][s].start.setTime(v[t[r].uid][s].start.getTime()+u)}if(v[t[r].uid][s].end){"string"==typeof v[t[r].uid][s].end&&(v[t[r].uid][s].end=$.fullCalendar.parseDate(v[t[r].uid][s].end));var m=v[t[r].uid][s].end;i=getOffsetByTZ(e,m).getSecondsFromOffset(),o="";if(o="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,m).getSecondsFromOffset():60*m.getTimezoneOffset()*-1,void 0!==a&&(o=getOffsetByTZ(v[t[r].uid][s].timeZone,d).getSecondsFromOffset()),void 0===a||a)u=1e3*(o-i);else var u=1e3*(i-o);v[t[r].uid][s].end.setTime(v[t[r].uid][s].end.getTime()+u)}var g=v[t[r].uid][s];if((0==s||s>0&&v[t[r].uid][s].id!=v[t[r].uid][s-1].id)&&g.alertTime.length>0){if(g.end)var _=new Date(g.end.getTime());else if(g.start)_=new Date(g.start.getTime());else _=new Date;for(var f=0;f<g.alertTimeOut.length;f++)clearTimeout(g.alertTimeOut[f]);for(var C="",T="",E=0;E<g.alertTime.length;E++){if("-"==g.alertTime[E].charAt(0)||"+"==g.alertTime[E].charAt(0)){C=_.getTime();var D=parseInt(g.alertTime[E].substring(1,g.alertTime[E].length-1));"-"==g.alertTime[E].charAt(0)?C-=D:C+=D,T=new Date}else{i=getOffsetByTZ(e,$.fullCalendar.parseDate(g.alertTime[E])).getSecondsFromOffset(),o="";if(o="undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone?getOffsetByTZ(globalSessionTimeZone,$.fullCalendar.parseDate(g.alertTime[E])).getSecondsFromOffset():60*$.fullCalendar.parseDate(g.alertTime[E]).getTimezoneOffset()*-1,void 0!==a&&(o=getOffsetByTZ(v[t[r].uid][s].timeZone,$.fullCalendar.parseDate(g.alertTime[E])).getSecondsFromOffset()),void 0===a||a)u=1e3*(o-i);else u=1e3*(i-o);C=new Date($.fullCalendar.parseDate(g.alertTime[E]).getTime()+u),v[t[r].uid][s].alertTime[E]=$.fullCalendar.formatDate(C,"yyyy-MM-dd HH:mm:ss"),T=new Date}if(C>T){var h=C-T;maxAlarmValue<h&&(h=maxAlarmValue),v[t[r].uid][s].alertTimeOut[E]=setTimeout(function(){showAlertEvents(g.id,C-T,{start:_,allDay:g.allDay,title:g.title})},h)}}}}++p==c&&(refetchTodoEvents(),l=!0,n&&$("#MainLoader").hide())},10,i)}function getLocalOffset(e){if("undefined"!=typeof globalSessionTimeZone&&null!=globalSessionTimeZone&&""!=globalSessionTimeZone)return-1*getOffsetByTZ(globalSessionTimeZone,e).getSecondsFromOffset();e.getTimezoneOffset()}function changeRuleForFuture(e,a){var n=e.vcalendar,l=n.match(vCalendar.pre.contentline_RRULE2);if(null!=l){parsed=l[0].match(vCalendar.pre.contentline_parse);for(var r=parsed[4].split(";"),t=!1,s=parsed[0],d=0;d<r.length;d++)-1==r[d].indexOf("UNTIL")&&-1==r[d].indexOf("COUNT")||(s=s.replace(r[d],"COUNT="+(a-1)),t=!0);if(!t){var c=parsed[4]+";COUNT="+(a-1);s=s.replace(parsed[4],c)}n=n.replace(parsed[0],s)}return n}function buildTimezoneComponent(e){var a="",n=["SU","MO","TU","WE","TH","FR","SA"];if(!e||"local"==e||"UTC"==e)return a;if(e in timezones){for(comp in a+="BEGIN:VTIMEZONE\r\nTZID:"+e+"\r\n",timezones[e]){if("daylightComponents"==comp)var l=timezones[e].daylightComponents,r="DAYLIGHT";else if("standardComponents"==comp)l=timezones[e].standardComponents,r="STANDARD";for(var t in l)if(!isNaN(t)){for(key in a+="BEGIN:"+r+"\r\n",l[t])switch(key){case"dtStart":a+="DTSTART:"+l[t][key]+"\r\n";break;case"tzName":a+="TZNAME:"+l[t][key]+"\r\n";break;case"tzOffsetFROM":a+="TZOFFSETFROM:"+l[t][key]+"\r\n";break;case"tzOffsetTO":a+="TZOFFSETTO:"+l[t][key]+"\r\n";break;case"startMonth":a+="RRULE:FREQ=YEARLY",l[t].startMonth&&(a+=";BYMONTH="+l[t].startMonth),void 0!==l[t].startDay&&void 0!==n[l[t].startDay]&&(l[t].startCount?a+=";BYDAY="+l[t].startCount+n[l[t].startDay]:a+=";BYDAY="+n[l[t].startDay]),a+="\r\n";break;case"rDates":if(l[t].rDates)for(var s=0;s<l[t].rDates.length;s++)a+="RDATE:"+l[t].rDates[s]+"\r\n"}a+="END:"+r+"\r\n"}}a+="END:VTIMEZONE\r\n"}return a}function getOffsetByTZ(e,a,n){var l="+0000";if(e in timezones&&"UTC"!=e){var r,t="",s="",d=!0,c=timezones[e].daylightComponents;if(c)for(var p=0;p<c.length;p++)if(!(c[p].dtStart.parseComnpactISO8601()>a)){if(d&&c[p].startMonth){r=getDateFromDay(t=c[p],a,!1,n);break}for(var i=0;i<c[p].rDates.length;i++)c[p].rDates[i].parseComnpactISO8601()<a&&(null==r||a-c[p].rDates[i].parseComnpactISO8601()<a-r.startDate)&&(r={offsetFrom:(t=c[p]).tzOffsetFROM,offsetTo:t.tzOffsetTO,startDate:c[p].rDates[i].parseComnpactISO8601()});d=!1}var o,v=timezones[e].standardComponents;if(d=!0,v)for(p=0;p<v.length;p++)if(!(v[p].dtStart.parseComnpactISO8601()>a)){if(d&&v[p].startMonth){o=getDateFromDay(t=v[p],a);break}for(i=0;i<v[p].rDates.length;i++)v[p].rDates[i].parseComnpactISO8601()<a&&(null==o||a-v[p].rDates[i].parseComnpactISO8601()<a-o.startDate)&&(o={offsetFrom:(s=v[p]).tzOffsetFROM,offsetTo:s.tzOffsetTO,startDate:v[p].rDates[i].parseComnpactISO8601()});d=!1}r&&o?l=r.startDate>o.startDate?r.offsetTo:o.offsetTo:r?l=r.offsetTo:o&&(l=o.offsetTo)}else"local"==e&&(l=getStringLocalOffset(a));return l}function getStringLocalOffset(e){var a="+0000",n=e.getTimezoneOffset();if(n>0)a="-"+((l=Math.floor(n/60))<10?"0"+l:l),a+=(r=n-60*l)<10?"0"+r:r;else if(n<0){var l,r;n*=-1,a="+"+((l=Math.floor(n/60))<10?"0"+l:l),a+=(r=n-60*l)<10?"0"+r:r}return a}function getDayLightObject(e,a){var n,l,r=a;n=getDateFromDay(e,a),l=getDateFromDay(e,a);for(var t=0;t<e.rDatesDT.length;t++){var s=e.rDatesDT[t].parseComnpactISO8601();if(s&&s.getFullYear()==a.getFullYear()){n=s;break}}for(t=0;t<e.rDatesST.length;t++){var d=e.rDatesST[t].parseComnpactISO8601();if(d&&d.getFullYear()==a.getFullYear()){l=d;break}}return n>l&&(r>n?l.setFullYear(l.getFullYear()+1):n.setFullYear(n.getFullYear()-1)),{dayLightStartDate:n,dayLightEndDate:l}}function deleteEventFromArray(e){var a=e.substring(0,e.lastIndexOf("/")+1),n=0;if(null!=globalEventList.displayEventsArray[a]&&void 0!==globalEventList.displayEventsArray[a])for(var l=globalEventList.displayEventsArray[a].length-1;l>=0;l--)if(globalEventList.displayEventsArray[a][l].id==e){n++;for(var r=0;r<globalEventList.displayEventsArray[a][l].alertTimeOut.length;r++)clearTimeout(globalEventList.displayEventsArray[a][l].alertTimeOut[r]);globalEventList.displayEventsArray[a].splice(l,1)}if(0==n&&null!=globalEventList.displayTodosArray[a]&&void 0!==globalEventList.displayTodosArray[a])for(l=globalEventList.displayTodosArray[a].length-1;l>=0;l--)if(globalEventList.displayTodosArray[a][l].id==e){for(r=0;r<globalEventList.displayTodosArray[a][l].alertTimeOut.length;r++)clearTimeout(globalEventList.displayTodosArray[a][l].alertTimeOut[r]);globalEventList.displayTodosArray[a].splice(l,1)}}function findEventInArray(e,a,n){var l=e.substring(0,e.lastIndexOf("/")+1),r=null;if(a){for(var t=0;t<globalEventList.displayEventsArray[l].length;t++)if(globalEventList.displayEventsArray[l][t].id==e)return globalEventList.displayEventsArray[l][t]}else for(t=0;t<globalEventList.displayTodosArray[l].length;t++)if(globalEventList.displayTodosArray[l][t].id==e){if(void 0===n||null==n)return globalEventList.displayTodosArray[l][t];if(globalEventList.displayTodosArray[l][t].repeatHash==n)return globalEventList.displayTodosArray[l][t];null==r&&(r=globalEventList.displayTodosArray[l][t])}return r||""}function getvCalendarstart(e){var a="",n=e.vcalendar;if(n.match(vCalendar.pre.vcalendar)){if(null!=(a=n.match(vCalendar.pre.beginVTODO)))return null!=n.match(vCalendar.pre.endVTODO)&&"1970-01-01T01:01:01Z";if(!(null!=(a=n.match(vCalendar.pre.beginVEVENT))))return!1;if(!(null!=(a=n.match(vCalendar.pre.endVEVENT))))return!1;var l,r="";if(null!=(a=(n=n.replace(/BEGIN:VTIMEZONE((\s|.)*?)END:VTIMEZONE\r\n/g,"")).match(vCalendar.pre.contentline_DTSTART))&&(parsed=a[0].match(vCalendar.pre.contentline_parse),r=l=-1==(l=r=parsed[4]).indexOf("T")?l.substring(0,4)+"-"+l.substring(4,6)+"-"+l.substring(6,8)+"T00:00:00Z":l.substring(0,4)+"-"+l.substring(4,6)+"-"+l.substring(6,8)+"T"+l.substring(9,11)+":"+l.substring(11,13)+":"+l.substring(13,15)+"Z"),""!=r)if("Invalid Date"==$.fullCalendar.parseDate(l).toString())return!1;return l}return-1}function giveMeUntilDate(e,a,n,l,r){var t=$.fullCalendar.parseDate(e),s=0,d=0;"DAILY"==n?(s=0,d=1):"WEEKLY"==n?(s=0,d=7):"MONTHLY"==n?(s=1,d=0):"YEARLY"==n&&(s=12,d=0);for(var c=1,p=1;c<a;){if(p%l==0&&c++,r)var i=new Date(t.getFullYear(),t.getMonth()+s,t.getDate()+d);else i=new Date(t.getFullYear(),t.getMonth()+s,t.getDate()+d,t.getHours(),t.getMinutes(),t.getSeconds());t=i,p++}return t}function checkAndFixMultipleUID(e,a){var n=e,l={},r=0,t=new Array,s="VEVENT";a||(s="VTODO");var d=n;for(null!=(m=d.match(vCalendar.pre.valarm))&&(d=d.replace(m[0],""));null!=d.match(vCalendar.pre.contentline_UID);)vcalendar_element=d.match(vCalendar.pre.contentline_UID),null!=vcalendar_element[0]&&void 0===l[vcalendar_element[0]]&&(l[vcalendar_element[0]]={isTimezone:!1,string:""},r++),d=d.replace(vcalendar_element[0],"\r\n");if(1==r)return[e];var c=n.indexOf("BEGIN:VTIMEZONE"),p=n.lastIndexOf("END:VTIMEZONE"),o=0,v="";if(-1!=c&&-1!=p){for(i=p+2;i<n.length;i++)if("\n"==n.charAt(i)){o=i+1;break}v=n.substring(c,o),n=n.substring(0,c)+n.substring(o,n.length)}for(;null!=n.match(vCalendar.pre[s.toLowerCase()]);){if("\r\n"==n.substring(n.indexOf("BEGIN:"+s)-2,n.indexOf("BEGIN:"+s))){var u=n.substring(n.indexOf("BEGIN:"+s)-2,n.indexOf("END:"+s)+("END:"+s).length);n=n.replace(u,"")}else{u=n.substring(n.indexOf("BEGIN:"+s),n.indexOf("END:"+s)+("END:"+s).length);n=n.replace(u,""),u+="\r\n"}var m,g=u;if(null!=(m=g.match(vCalendar.pre.valarm))&&(g=g.replace(m[0],"")),vcalendar_element=g.match(vCalendar.pre.contentline_UID),null!=vcalendar_element[0]){var _;if(null!=(_=g.match(vCalendar.pre.contentline_DTSTART))){var f=_[0].match(vCalendar.pre.contentline_parse);-1!=vcalendarSplitParam(f[3]).indexElementOf("TZID=")&&(l[vcalendar_element[0]].isTimezone=!0)}if(!a&&!l[vcalendar_element[0]].isTimezone)if(null!=(_=g.match(vCalendar.pre.contentline_DUE))){f=_[0].match(vCalendar.pre.contentline_parse);-1!=vcalendarSplitParam(f[3]).indexElementOf("TZID=")&&(l[vcalendar_element[0]].isTimezone=!0)}l[vcalendar_element[0]].string+=u}}for(var C in l){var T="";null!=vCalendar.tplM.begin&&null!=(process_elem=vCalendar.tplM.begin[0])?T+=vCalendar.tplM.begin[0]:(process_elem=vCalendar.tplC.begin,process_elem=process_elem.replace("##:::##group_wd##:::##",""),T+=process_elem),null!=vCalendar.tplM.contentline_VERSION&&null!=(process_elem=vCalendar.tplM.contentline_VERSION[0])?""!=(f=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+f[1].replace(".","\\."),"mg"),"\r\nitem"+groupCounter+++".").substring(2)):(process_elem=vCalendar.tplC.contentline_VERSION,process_elem=process_elem.replace("##:::##group_wd##:::##","")),process_elem=process_elem.replace("##:::##version##:::##","2.0"),T+=process_elem,null!=vCalendar.tplM.contentline_CALSCALE&&null!=(process_elem=vCalendar.tplM.contentline_CALSCALE[0])?""!=(f=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+f[1].replace(".","\\."),"mg"),"\r\nitem"+groupCounter+++".").substring(2)):(process_elem=vCalendar.tplC.contentline_CALSCALE,process_elem=process_elem.replace("##:::##group_wd##:::##","")),process_elem=process_elem.replace("##:::##calscale##:::##","GREGORIAN"),T+=process_elem,l[C].isTimezone&&(T+=v),T=T.substring(0,T.length-2),(T+=l[C].string).lastIndexOf("\r\n")!=T.length-2&&(T+="\r\n"),null!=vCalendar.tplM.contentline_PRODID&&null!=(process_elem=vCalendar.tplM.contentline_PRODID[0])?""!=(f=("\r\n"+process_elem).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(process_elem=("\r\n"+process_elem).replace(RegExp("\r\n"+f[1].replace(".","\\."),"mg"),"\r\nitem"+groupCounter+++".").substring(2)):(process_elem=vCalendar.tplC.contentline_PRODID,process_elem=process_elem.replace("##:::##group_wd##:::##",""),process_elem=process_elem.replace("##:::##params_wsc##:::##","")),process_elem=process_elem.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),T+=process_elem,void 0!==vCalendar.tplM.unprocessed&&""!=vCalendar.tplM.unprocessed&&null!=vCalendar.tplM.unprocessed&&(T+=vCalendar.tplM.unprocessed.replace(RegExp("^\r\n"),"")),vCalendar.tplM.unprocessed=new Array,null!=vCalendar.tplM.end&&null!=(process_elem=vCalendar.tplM.end[0])?T+=vCalendar.tplM.end[0]:(process_elem=vCalendar.tplC.end,process_elem=process_elem.replace("##:::##group_wd##:::##",""),T+=process_elem),t.push(T)}return t}function dataToVcalendar(e,a,n,l,r,t,s){var d=!1,c="",p=0,i="local";if(null!=vCalendar.tplM.begin&&null!=(I=vCalendar.tplM.begin[0])?c+=vCalendar.tplM.begin[0]:c+=I=(I=vCalendar.tplC.begin).replace("##:::##group_wd##:::##",""),null!=vCalendar.tplM.contentline_VERSION&&null!=(I=vCalendar.tplM.contentline_VERSION[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=vCalendar.tplC.contentline_VERSION).replace("##:::##group_wd##:::##",""),c+=I=I.replace("##:::##version##:::##","2.0"),null!=vCalendar.tplM.contentline_CALSCALE&&null!=(I=vCalendar.tplM.contentline_CALSCALE[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=vCalendar.tplC.contentline_CALSCALE).replace("##:::##group_wd##:::##",""),c+=I=I.replace("##:::##calscale##:::##","GREGORIAN"),""!=r)var o=r.substring(0,r.lastIndexOf("/")+1);else o=n.substring(0,n.lastIndexOf("/")+1);var v=jQuery.grep(globalEventList.displayEventsArray[o],function(e){if(e.id==$("#uid").val()&&(e.repeatCount<2||!e.repeatCount))return!0}),u=new Array,m="",g=!1,_="",f=new Array;if(v.length>0)for((o=$("#uid").val().substring(0,$("#uid").val().lastIndexOf("/")+1))&&null!=globalEventList.events[o][$("#uid").val()].uid&&(_=globalEventList.events[o][$("#uid").val()].vcalendar);null!=_.match(vCalendar.pre.vevent);){if("\r\n"==_.substring(_.indexOf("BEGIN:VEVENT")-2,_.indexOf("BEGIN:VEVENT"))){var C=_.substring(_.indexOf("BEGIN:VEVENT")-2,_.indexOf("END:VEVENT")+"END:VEVENT".length);_=_.replace(C,"")}else{C=_.substring(_.indexOf("BEGIN:VEVENT"),_.indexOf("END:VEVENT")+"END:VEVENT".length);_=_.replace(C,""),C+="\r\n"}f[f.length]=C}for(var T="",E=0;E<v.length;E++)if(-1==u.indexOf(v[E].timeZone)){if(v[E].allDay||s&&$("#vcalendarHash").val()==hex_sha256(v[E].vcalendar))continue;var D=buildTimezoneComponent(v[E].timeZone);""!=D&&$("#vcalendarHash").val()!=hex_sha256(v[E].vcalendar)?(u[u.length]=v[E].timeZone,(m+=D).lastIndexOf("\r\n")!=m.length-2&&(m+="\r\n"),g=!0):""!=D&&$("#vcalendarHash").val()==hex_sha256(v[E].vcalendar)&&(T+=D)}g&&(c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),c+=m);for(var h=c,M="",A=!1,O=0;O<v.length;O++)if(f.splice(f.indexOf(v[O].vcalendar),1),""==$("#futureStart").val()&&$("#vcalendarHash").val()!=hex_sha256(v[O].vcalendar)||v[O].rec_id!=$("#recurrenceID").val()){var R=v[O].vcalendar.match(vCalendar.pre.contentline_UID);if(null!=R&&(R=R[0].match(vCalendar.pre.contentline_parse)[4]),s&&$("#vcalendarHash").val()==hex_sha256(v[O].vcalendar)||s&&!v[O].rec_id&&$("#vcalendarUID").val()==R){var b=v[O].vcalendar.match(vCalendar.pre.contentline_RRULE2),S=v[O].start,I=vCalendar.tplC.contentline_EXDATE;if(I=(I=I.replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),v[O].allDay)S=$("#recurrenceID").val(),I=(I=(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE"))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(S));else{if(S=$("#recurrenceID").val().parseComnpactISO8601(),$("#allday").prop("checked")||globalSettings.timezonesupport.value&&(i=$("#timezone").val()),"local"!=i){var y=-1*(ce=getOffsetByTZ(i,S)).getSecondsFromOffset();S=new Date(S.setSeconds(y))}else S=new Date(S.setSeconds(getLocalOffset(S)));S=$.fullCalendar.formatDate(S,"yyyyMMdd'T'HHmmss'Z'"),I=(I=(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue(""))).replace("##:::##TZID##:::##","")).replace("##:::##value##:::##",vcalendarEscapeValue(S))}v[O].vcalendar=v[O].vcalendar.replace(b,b+I)}0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar.substring(2,v[O].vcalendar.length):0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar:c+="\r\n"+v[O].vcalendar}else""!=$("#futureStart").val().split(";")[0]&&$("#futureStart").val().split(";")[1]!=v[O].start?($("#futureStart").val().split(";")[0]>1&&$("#vcalendarHash").val()==hex_sha256(v[O].vcalendar)&&(v[O].vcalendar=changeRuleForFuture(v[O],$("#futureStart").val().split(";")[0])),0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar.substring(2,v[O].vcalendar.length):0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar:c+="\r\n"+v[O].vcalendar,A=!0):s&&""!=$("#futureStart").val().split(";")[0]&&$("#futureStart").val().split(";")[1]==v[O].start?($("#vcalendarHash").val()==hex_sha256(v[O].vcalendar)&&(v[O].vcalendar=changeRuleForFuture(v[O],2)),0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar.substring(2,v[O].vcalendar.length):0==v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=v[O].vcalendar.indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=v[O].vcalendar:c+="\r\n"+v[O].vcalendar):M=v[O];c=c.replace(M.vcalendar,"");for(var N=0;N<f.length;N++)0==f[N].indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=f[N].substring(2,f[N].length):0==f[N].indexOf("\r\n")&&c.lastIndexOf("\r\n")!=c.length-2||0!=f[N].indexOf("\r\n")&&c.lastIndexOf("\r\n")==c.length-2?c+=f[N]:c+="\r\n"+f[N];var V="";if(s||A){if(c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),!g&&A&&""!=T&&(c+=T).lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),null!=vCalendar.tplM.contentline_PRODID&&null!=(I=vCalendar.tplM.contentline_PRODID[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_PRODID).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),void 0!==vCalendar.tplM.unprocessed&&""!=vCalendar.tplM.unprocessed&&null!=vCalendar.tplM.unprocessed&&(c+=vCalendar.tplM.unprocessed.replace(RegExp("^\r\n"),"")),vCalendar.tplM.unprocessed=new Array,null!=vCalendar.tplM.end&&null!=(I=vCalendar.tplM.end[0])?c+=vCalendar.tplM.end[0]:c+=I=(I=vCalendar.tplC.end).replace("##:::##group_wd##:::##",""),s){var x=(We=checkAndFixMultipleUID(c,!0))[0];return We.splice(0,1),putVcalendarToCollection(a,n,l,x,r,"vevent",t,s,We)}A&&(V=c,c=h)}var w="";"undefined"!=typeof globalSessionTimeZone&&globalSessionTimeZone&&(i=globalSessionTimeZone);var L,U,Z=!1;if(!$("#allday").prop("checked")){globalSettings.timezonesupport.value&&(i=$("#timezone").val()),"UTC"==i?(Z=!0,w=""):w="local"==i?"":"custom"==i?";"+vcalendarEscapeValue("TZID="+M.timeZone):";"+vcalendarEscapeValue("TZID="+i);var Y="";globalSettings.rewritetimezonecomponent.value||!vCalendar.tplM.unprocessedVTIMEZONE?-1==u.indexOf(i)&&(Y=buildTimezoneComponent(i)):Y=vCalendar.tplM.unprocessedVTIMEZONE,c.lastIndexOf("\r\n")!=c.length-2&&(c+="\r\n"),c+=Y}null!=vCalendar.tplM.beginVEVENT&&null!=(I=vCalendar.tplM.beginVEVENT[0])?(c.lastIndexOf("\r\n")==c.length-2?c+=vCalendar.tplM.beginVEVENT[0]:c+="\r\n"+vCalendar.tplM.beginVEVENT[0],d=!0):(I=(I=vCalendar.tplC.beginVEVENT).replace("##:::##group_wd##:::##",""),c.lastIndexOf("\r\n")==c.length-2?c+=I:c+="\r\n"+I,d=!0),L=(U=new Date).getUTCFullYear()+(U.getUTCMonth()+1<10?"0":"")+(U.getUTCMonth()+1)+(U.getUTCDate()<10?"0":"")+U.getUTCDate()+"T"+(U.getUTCHours()<10?"0":"")+U.getUTCHours()+(U.getUTCMinutes()<10?"0":"")+U.getUTCMinutes()+(U.getUTCSeconds()<10?"0":"")+U.getUTCSeconds()+"Z";if(""==$("#recurrenceID").val())var k="orig";else k=$("#recurrenceID").val();var F="";for(vev in vCalendar.tplM.contentline_CREATED)vev==k&&(F=vCalendar.tplM.contentline_CREATED[vev]);if(""!=F?""!=(He=("\r\n"+(I=F)).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=(I=vCalendar.tplC.contentline_CREATED).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##","")).replace("##:::##value##:::##",vcalendarEscapeValue(L)),c+=I,null!=vCalendar.tplM.contentline_LM&&null!=(I=vCalendar.tplM.contentline_LM[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_LM).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue(L)),null!=vCalendar.tplM.contentline_DTSTAMP&&null!=(I=vCalendar.tplM.contentline_DTSTAMP[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_DTSTAMP).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue(L)),""==$("#futureStart").val()&&"MOVE_IN"!=e&&"MOVE_OTHER"!=e&&null!=vCalendar.tplM.contentline_UID&&null!=(I=vCalendar.tplM.contentline_UID[0]))""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2));else{I=(I=(I=vCalendar.tplC.contentline_UID).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##","");var H=globalEventList.getNewUID();I=I.replace("##:::##uid##:::##",H)}if(c+=I,null!=vCalendar.tplM.contentline_SUMMARY&&null!=(I=vCalendar.tplM.contentline_SUMMARY[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_SUMMARY).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#name").val())),"0"!=$("#priority").val()&&(null!=vCalendar.tplM.contentline_PRIORITY&&null!=(I=vCalendar.tplM.contentline_PRIORITY[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_PRIORITY).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#priority").val()))),d){if("no-repeat"!=$("#repeat").val()){var B=$("#repeat_interval_detail").val(),P="",z="",G="",W="",X=!1;B=1==B||""==B?"":";INTERVAL="+$("#repeat_interval_detail").val();var K=$("#repeat").val();if("TWO_WEEKLY"==K)K="WEEKLY",B=";INTERVAL=2";else if("BUSINESS"==K){if(K="WEEKLY",P=";BYDAY=",globalSettings.weekenddays.value.length>0){for(var Q=0;Q<7;Q++)-1==globalSettings.weekenddays.value.indexOf(Q)&&(P+=Q+",");P=(P=P.substring(0,P.length-1)).replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")}else P="SA,SU";B=""}else if("WEEKEND"==K){if(K="WEEKLY",P=";BYDAY=",globalSettings.weekenddays.value.length>0){for(Q=0;Q<globalSettings.weekenddays.value.length;Q++)P+=globalSettings.weekenddays.value[Q]+",";P=(P=P.substring(0,P.length-1)).replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")}else P="SA,SU";B=""}else if("CUSTOM_WEEKLY"==K){K="WEEKLY";var j=$("#week_custom .customTable td.selected");if(j.length>0){P=";BYDAY=";for(var J=0;J<j.length;J++)P+=$(j[J]).attr("data-type")+",";P=(P=P.substring(0,P.length-1)).replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU"),null!=globalSettings.mozillasupport.value&&globalSettings.mozillasupport.value||(""!=M?""!=M.wkst&&(W=";WKST="+M.wkst.replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU")):W=";WKST="+globalSettings.datepickerfirstdayofweek.value.toString().replace(1,"MO").replace(2,"TU").replace(3,"WE").replace(4,"TH").replace(5,"FR").replace(6,"SA").replace(0,"SU"))}}else if("CUSTOM_MONTHLY"==K){K="MONTHLY";var q="";if("custom"!=(ae=$("#repeat_month_custom_select").val())&&"DAY"!=$("#repeat_month_custom_select2").val()){switch(""!=ae&&(P=";BYDAY="),ae){case"every":q="";break;case"first":q="1";break;case"second":q="2";break;case"third":q="3";break;case"fourth":q="4";break;case"fifth":q="5";break;case"last":q="-1";break;default:q=""}P+=q+$("#repeat_month_custom_select2").val()}else if("custom"!=ae&&"DAY"==$("#repeat_month_custom_select2").val())switch(P="",ae){case"every":z=";BYMONTHDAY=";for(var ee=1;ee<32;ee++)z+=ee+",";z=z.substring(0,z.length-1);break;case"first":z=";BYMONTHDAY=1";break;case"second":z=";BYMONTHDAY=2";break;case"third":z=";BYMONTHDAY=3";break;case"fourth":z=";BYMONTHDAY=4";break;case"fifth":z=";BYMONTHDAY=5";break;case"last":z=";BYMONTHDAY=-1";break;default:q="",z=""}else{if((re=$("#month_custom2 .selected")).length>0){z=";BYMONTHDAY=";for(J=0;J<re.length;J++)z+=$(re[J]).attr("data-type")+",";z=z.substring(0,z.length-1)}}}else if("CUSTOM_YEARLY"==K){K="YEARLY";q="";var ae=$("#repeat_year_custom_select1").val(),ne=$("#year_custom3 .selected");if(ne.length>0){G=";BYMONTH=";for(J=0;J<ne.length;J++){var le=parseInt($(ne[J]).attr("data-type"),10);isNaN(le)||(G+=le+1+",")}G=G.substring(0,G.length-1)}if("custom"!=ae&&"DAY"!=$("#repeat_year_custom_select2").val()){switch(""!=ae&&(P=";BYDAY="),ae){case"every":q="";break;case"first":q="1";break;case"second":q="2";break;case"third":q="3";break;case"fourth":q="4";break;case"fifth":q="5";break;case"last":q="-1";break;default:q=""}P+=q+$("#repeat_year_custom_select2").val()}else if("custom"!=ae&&"DAY"==$("#repeat_year_custom_select2").val())switch(P="",ae){case"every":z=";BYMONTHDAY=";for(ee=1;ee<32;ee++)z+=ee+",";z=z.substring(0,z.length-1);break;case"first":z=";BYMONTHDAY=1";break;case"second":z=";BYMONTHDAY=2";break;case"third":z=";BYMONTHDAY=3";break;case"fourth":z=";BYMONTHDAY=4";break;case"fifth":z=";BYMONTHDAY=5";break;case"last":z=";BYMONTHDAY=-1";break;default:q="",z=""}else{var re;if((re=$("#year_custom1 .selected")).length>0){z=";BYMONTHDAY=";for(J=0;J<re.length;J++)z+=$(re[J]).attr("data-type")+",";z=z.substring(0,z.length-1)}}}else"custom_repeat"==$("#repeat option:selected").attr("data-type")&&(X=!0);if(null!=vCalendar.tplM.contentline_RRULE&&null!=(I=vCalendar.tplM.contentline_RRULE[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_RRULE).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),X)I=I.replace("##:::##value##:::##",$("#repeat").val());else if("on_date"==$("#repeat_end_details").val()){var te=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#repeat_end_date").val()),se="";if($("#allday").prop("checked"))se=$.fullCalendar.formatDate(te,"yyyyMMdd")+"T000000Z";else{var de=new Date(Date.parse("01/02/1990, "+$("#time_from").val()));if(te.setHours(de.getHours()),te.setMinutes(de.getMinutes()),te.setSeconds(de.getSeconds()),globalSettings.timezonesupport.value&&i in timezones)var ce=getOffsetByTZ(i,te);if(ce){y=1e3*ce.getSecondsFromOffset()*-1;te.setTime(te.getTime()+y)}se=$.fullCalendar.formatDate(te,"yyyyMMdd'T'HHmmss'Z'")}I=I.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+K)+B+";UNTIL="+se+G+z+P+W)}else I="after"==$("#repeat_end_details").val()?I.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+K)+B+";COUNT="+parseInt($("#repeat_end_after").val())+G+z+P+W):I.replace("##:::##value##:::##",vcalendarEscapeValue("FREQ="+K)+B+G+z+P+W);if(c+=I,M.repeatStart){var pe=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),ie=M.repeatStart,oe=new Date(1970,1,1,0,0,0);$("#allday").prop("checked")||(oe=new Date(Date.parse("01/02/1990, "+$("#time_from").val())),pe.setHours(oe.getHours()),pe.setMinutes(oe.getMinutes()),pe.setSeconds(oe.getSeconds()));var ve=pe-ie;for(var ue in vCalendar.tplM.contentline_EXDATE)if(!isNaN(ue)){var me=("\r\n"+vCalendar.tplM.contentline_EXDATE[ue]).match(vCalendar.pre.contentline_parse),ge=me[4].parseComnpactISO8601();if(ge){if(-1!=me[4].indexOf("T")||$("#allday").prop("checked")){if(-1!=me[4].indexOf("T")&&!$("#allday").prop("checked"))if("local"!=i){ce=getOffsetByTZ(i,ge);var _e=getOffsetByTZ(M.timeZone,ge);y=-1*(ce.getSecondsFromOffset()-_e.getSecondsFromOffset());ge=new Date(ge.setSeconds(y))}else{_e=getOffsetByTZ(M.timeZone,ge);ge=new Date(ge.setSeconds(_e.getSecondsFromOffset()))}}else{new Date(Date.parse("01/02/1990, "+$("#time_from").val()));var fe=$.fullCalendar.formatDate(oe,"HHmmss");if(ge=(me[4]+"T"+fe).parseComnpactISO8601(),"local"!=i){var y=-1*(ce=getOffsetByTZ(i,ge)).getSecondsFromOffset();ge=new Date(ge.setSeconds(y))}}var Ce=new Date(ge.getTime()+ve);if(I=(I=(I=vCalendar.tplC.contentline_EXDATE).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),$("#allday").prop("checked")){var Te=$.fullCalendar.formatDate(Ce,"yyyyMMdd");I=(I=(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE"))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(Te))}else Te=$.fullCalendar.formatDate(Ce,"yyyyMMdd'T'HHmmss")+("local"!=i?"Z":""),I=(I=(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue(""))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(Te));c+=I}}}}pe=$("#eventDetailsTable").find("tr[data-id]");var Ee=0;for(Q=0;Q<pe[pe.length-1].attributes.length;Q++)if("data-id"==pe[pe.length-1].attributes[Q].nodeName){Ee=pe[pe.length-1].attributes[Q].value;break}for(var De=new Array,he=0;he<Ee;he++)if($(".alert[data-id="+(he+1)+"]").length>0){var Me="";if("none"!=$(".alert[data-id="+(he+1)+"]").val()){if(null!=vCalendar.tplM.beginVALARM&&null!=(I=vCalendar.tplM.beginVALARM[0])?Me+=vCalendar.tplM.beginVALARM[0]:(Me+=I=(I=vCalendar.tplC.beginVALARM).replace("##:::##group_wd##:::##",""),d=!0),"message"==$(".alert[data-id="+(he+1)+"]").val()){if("on_date"==$(".alert_message_details[data-id="+(he+1)+"]").val()){null!=vCalendar.tplM.contentline_TRIGGER&&null!=(I=vCalendar.tplM.contentline_TRIGGER[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_TRIGGER).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##","");var Ae=$.datepicker.parseDate(globalSettings.datepickerformat.value,$(".message_date_input[data-id="+(he+1)+"]").val()),Oe=$.fullCalendar.formatDate(Ae,"yyyy-MM-dd"),Re=new Date(Date.parse("01/02/1990, "+$(".message_time_input[data-id="+(he+1)+"]").val())),be=$.fullCalendar.formatDate(Re,"HH:mm:ss"),Se=$.fullCalendar.parseDate(Oe+"T"+be);if(globalSettings.timezonesupport.value&&(i=$("#timezone").val()),"none"==$(".timezone_row").css("display")&&(i="local"),"local"!=i){var Ie=-1*(_e=getOffsetByTZ(i,Se)).getSecondsFromOffset();Se=new Date(Se.setSeconds(Ie))}Te=$.fullCalendar.formatDate(Se,"yyyyMMdd'T'HHmmss")+("local"!=i?"Z":"");Me+=I=(I=(I=I.replace("##:::##VALUE=DATE-TIME##:::##",";VALUE=DATE-TIME")).replace("##:::##VALUE=DURATION##:::##","")).replace("##:::##value##:::##",vcalendarEscapeValue(Te))}else{var ye="",Ne=$(".before_after_input[data-id="+(he+1)+"]").val();"minutes_before"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="-PT"+Ne+"M"),"hours_before"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="-PT"+Ne+"H"),"days_before"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="-P"+Ne+"D"),"weeks_before"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="-P"+Ne+"W"),"seconds_before"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="-PT"+Ne+"S"),"minutes_after"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="PT"+Ne+"M"),"hours_after"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="PT"+Ne+"H"),"days_after"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="P"+Ne+"D"),"weeks_after"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="P"+Ne+"W"),"seconds_after"==$(".alert_message_details[data-id="+(he+1)+"]").val()&&(ye="PT"+Ne+"S"),null!=vCalendar.tplM.contentline_TRIGGER&&null!=(I=vCalendar.tplM.contentline_TRIGGER[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_TRIGGER).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),Me+=I=(I=(I=I.replace("##:::##VALUE=DATE-TIME##:::##","")).replace("##:::##VALUE=DURATION##:::##",";VALUE=DURATION")).replace("##:::##value##:::##",ye)}null!=vCalendar.tplM.contentline_ACTION&&null!=(I=vCalendar.tplM.contentline_ACTION[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_ACTION).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),Me+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue("DISPLAY"));pe=new Date;null!=vCalendar.tplM.contentline_DESCRIPTION&&null!=(I=vCalendar.tplM.contentline_DESCRIPTION[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_DESCRIPTION).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),Me+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue("Reminder"))}void 0!==vCalendar.tplM.unprocessedVALARM&&void 0!==vCalendar.tplM.unprocessedVALARM[he]&&""!=vCalendar.tplM.unprocessedVALARM[he]&&null!=vCalendar.tplM.unprocessedVALARM[he]&&(tmp=vCalendar.tplM.unprocessedVALARM[he].replace(RegExp("^\r\n"),"").replace(RegExp("\r\n$"),""),0==tmp.indexOf("\r\n")&&(tmp=tmp.substring(2,tmp.length)),tmp.lastIndexOf("\r\n")!=tmp.length-2&&(tmp+="\r\n"),Me+=tmp),null!=vCalendar.tplM.endVALARM&&null!=(I=vCalendar.tplM.endVALARM[0])?Me+=vCalendar.tplM.endVALARM[0]:Me+=I=(I=vCalendar.tplC.endVALARM).replace("##:::##group_wd##:::##",""),-1==De.indexOf(Me)&&(De.push(Me),c+=Me)}}vCalendar.tplM.unprocessedVALARM=new Array,"none"!=$("#avail").val()&&(null!=vCalendar.tplM.contentline_TRANSP&&null!=(I=vCalendar.tplM.contentline_TRANSP[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_TRANSP).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I="busy"==$("#avail").val()?I.replace("##:::##value##:::##",vcalendarEscapeValue("OPAQUE")):I.replace("##:::##value##:::##",vcalendarEscapeValue("TRANSPARENT"))),""!=$("#url_EVENT").val()&&(null!=vCalendar.tplM.contentline_URL&&null!=(I=vCalendar.tplM.contentline_URL[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_URL).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#url_EVENT").val())))}if(""!=$("#note").val()&&(null!=vCalendar.tplM.contentline_NOTE&&null!=(I=vCalendar.tplM.contentline_NOTE[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_NOTE).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#note").val()))),"NONE"!=$("#status").val()&&(null!=vCalendar.tplM.contentline_STATUS&&null!=(I=vCalendar.tplM.contentline_STATUS[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_STATUS).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#status").val()))),""!=$("#type").val()&&(null!=vCalendar.tplM.contentline_CLASS&&null!=(I=vCalendar.tplM.contentline_CLASS[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):(I=(I=(I=vCalendar.tplC.contentline_CLASS).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),void 0!==vCalendar.tplM.contentline_CLASS&&null!=vCalendar.tplM.contentline_CLASS&&0!=vCalendar.tplM.contentline_CLASS.length||(I="")),"none"!=$(".row_type").css("display")&&(I=(I=(I=(I=vCalendar.tplC.contentline_CLASS).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##","")).replace("##:::##value##:::##",vcalendarEscapeValue($("#type").val().toUpperCase()))),c+=I),$("#recurrenceID").val()){null!=vCalendar.tplM.contentline_REC_ID&&null!=(I=vCalendar.tplM.contentline_REC_ID[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_REC_ID).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##","");var Ve=$("#recurrenceID").val();-1==Ve.indexOf("T")?I=(I=(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE"))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(Ve)):(I=(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue(""))).replace("##:::##TZID##:::##",w),Z&&"Z"!=Ve.charAt(Ve.length-1)&&(Ve+="Z"),I=I.replace("##:::##value##:::##",vcalendarEscapeValue(Ve))),c+=I}null!=vCalendar.tplM.contentline_E_DTSTART&&null!=(I=vCalendar.tplM.contentline_E_DTSTART[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_E_DTSTART).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##","");var xe="",we=(Oe="",pe=$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_from").val()),$.datepicker.parseDate(globalSettings.datepickerformat.value,$("#date_to").val()));oe=new Date(1970,1,1,0,0,0);""==xe&&(xe=$.fullCalendar.formatDate(pe,"yyyyMMdd")),""==Oe&&(Oe=$.fullCalendar.formatDate(we,"yyyyMMdd"));Ae=$.datepicker.parseDate("yymmdd",Oe);if($("#allday").prop("checked"))I=(I=(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE"))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(xe));else{oe=new Date(Date.parse("01/02/1990, "+$("#time_from").val()));fe=$.fullCalendar.formatDate(oe,"HHmmss");I=(I=(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue(""))).replace("##:::##TZID##:::##",w)).replace("##:::##value##:::##",vcalendarEscapeValue(xe+"T"+fe+(Z?"Z":"")))}if(c+=I,""!=M&&""!=M.type){ie=M.repeatStart;pe.setHours(oe.getHours()),pe.setMinutes(oe.getMinutes()),pe.setSeconds(oe.getSeconds());ve=pe-ie;var Le=M.vcalendar.match(vCalendar.pre.contentline_UID);if(null!=Le&&(Le=Le[0].match(vCalendar.pre.contentline_parse)[4]),0!=ve){for(var Ue=c,$e=new Array,Ze=new Array;null!=Ue.match(vCalendar.pre.vevent);){if("\r\n"==Ue.substring(Ue.indexOf("BEGIN:VEVENT")-2,Ue.indexOf("BEGIN:VEVENT"))){C=Ue.substring(Ue.indexOf("BEGIN:VEVENT")-2,Ue.indexOf("END:VEVENT")+"END:VEVENT".length);Ue=Ue.replace(C,"")}else{C=Ue.substring(Ue.indexOf("BEGIN:VEVENT"),Ue.indexOf("END:VEVENT")+"END:VEVENT".length);Ue=Ue.replace(C,""),C+="\r\n"}$e[$e.length]=C,Ze[Ze.length]=C}0==$e.length&&console.log("Error: '"+n+"': unable to parse vEvent");for(var Ye=0;Ye<$e.length;Ye++){var ke=$e[Ye].match(vCalendar.pre.contentline_UID);if(null==ke||ke[0].match(vCalendar.pre.contentline_parse)[4]==Le){var Fe=$e[Ye].match(vCalendar.pre.contentline_RECURRENCE_ID);if(null!=Fe){var He=Fe[0].match(vCalendar.pre.contentline_parse);if(I=(I=(I=vCalendar.tplC.contentline_REC_ID).replace("##:::##group_wd##:::##",He[1])).replace("##:::##params_wsc##:::##",""),Ce=He[4].parseComnpactISO8601()){Ce=new Date(Ce.getTime()+ve);Te=$.fullCalendar.formatDate(Ce,"yyyyMMdd'T'HHmmss");Z&&(Te+="Z"),$("#allday").prop("checked")?(Te=$.fullCalendar.formatDate(Ce,"yyyyMMdd"),I=(I=(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE"))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(Te))):I=(I=(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue(""))).replace("##:::##TZID##:::##",w)).replace("##:::##value##:::##",vcalendarEscapeValue(Te)),$e[Ye]=$e[Ye].replace(Fe[0],"\r\n"+I)}}c=c.replace(Ze[Ye],$e[Ye])}}}}if(null!=vCalendar.tplM.contentline_E_DTEND&&null!=(I=vCalendar.tplM.contentline_E_DTEND[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_E_DTEND).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),$("#allday").prop("checked")){var Be=new Date(Ae.getFullYear(),Ae.getMonth(),Ae.getDate()+1);Be=Be.getFullYear()+""+(Be.getMonth()+1<10?"0"+(Be.getMonth()+1):Be.getMonth()+1)+(Be.getDate()<10?"0"+Be.getDate():Be.getDate()),I=(I=(I=I.replace("##:::##AllDay##:::##",";"+vcalendarEscapeValue("VALUE=DATE"))).replace("##:::##TZID##:::##",vcalendarEscapeValue(""))).replace("##:::##value##:::##",vcalendarEscapeValue(Be))}else{var Pe=new Date(Date.parse("01/02/1990, "+$("#time_to").val()));be=$.fullCalendar.formatDate(Pe,"HHmmss");I=(I=(I=I.replace("##:::##AllDay##:::##",vcalendarEscapeValue(""))).replace("##:::##TZID##:::##",w)).replace("##:::##value##:::##",vcalendarEscapeValue(Oe+"T"+be+(Z?"Z":"")))}if(c+=I,null!=vCalendar.tplM.contentline_LOCATION&&null!=(I=vCalendar.tplM.contentline_LOCATION[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_LOCATION).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),""!=$("#location").val()&&(c+=I=I.replace("##:::##value##:::##",vcalendarEscapeValue($("#location").val()))),""==$("#recurrenceID").val())k="orig";else k=$("#recurrenceID").val();if(void 0!==vCalendar.tplM.unprocessedVEVENT&&null!=vCalendar.tplM.unprocessedVEVENT)for(vev in vCalendar.tplM.unprocessedVEVENT)vev==k&&(c+=vCalendar.tplM.unprocessedVEVENT[vev].replace(RegExp("^\r\n"),""));null!=vCalendar.tplM.endVEVENT&&null!=(I=vCalendar.tplM.endVEVENT[0])?c+=vCalendar.tplM.endVEVENT[0]:c+=I=(I=vCalendar.tplC.endVEVENT).replace("##:::##group_wd##:::##",""),null!=vCalendar.tplM.contentline_PRODID&&null!=(I=vCalendar.tplM.contentline_PRODID[0])?""!=(He=("\r\n"+I).match(RegExp("\r\n((?:"+vCalendar.re.group+"\\.)?)","m")))[1]&&(I=("\r\n"+I).replace(RegExp("\r\n"+He[1].replace(".","\\."),"mg"),"\r\nitem"+p+++".").substring(2)):I=(I=(I=vCalendar.tplC.contentline_PRODID).replace("##:::##group_wd##:::##","")).replace("##:::##params_wsc##:::##",""),c+=I=I.replace("##:::##value##:::##","-//Inf-IT//"+globalAppName+" "+globalVersion+"//EN"),void 0!==vCalendar.tplM.unprocessed&&""!=vCalendar.tplM.unprocessed&&null!=vCalendar.tplM.unprocessed&&(c+=vCalendar.tplM.unprocessed.replace(RegExp("^\r\n"),"")),vCalendar.tplM.unprocessed=new Array,null!=vCalendar.tplM.end&&null!=(I=vCalendar.tplM.end[0])?c+=vCalendar.tplM.end[0]:c+=I=(I=vCalendar.tplC.end).replace("##:::##group_wd##:::##","");var ze=new Array;if(A&&""!=V){var Ge=checkAndFixMultipleUID(V,!0);1==Ge.length?ze[ze.length]=V:ze=Ge}var We=checkAndFixMultipleUID(c=c.replace(/[^\u0009\u000A\u000D\u0020-\uD7FF\uE000-\uFFFD]/g," "),!0);x=(We=$.merge(ze,We))[0];return We.splice(0,1),"MOVE_IN"==e?moveVcalendarToCollection(a,n,l,x,r,"vevent",t,s,We):putVcalendarToCollection(a,n,l,x,r,"vevent",t,s,We)}function fullVcalendarToData(e){CalDAVeditor_cleanup();var a="",n=e.id.substring(0,e.id.lastIndexOf("/")+1);if(null!=globalEventList.events[n][e.id].uid&&(a=globalEventList.events[n][e.id].vcalendar),!a)return!1;var l=a.split("\r\n");if(null==(parsed=("\r\n"+l[0]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.begin[0]=vCalendar.tplC.begin.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+l[l.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.end[0]=vCalendar.tplC.end.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;var r=(a="\r\n"+l.slice(1,l.length-2).join("\r\n")+"\r\n").indexOf("BEGIN:VTIMEZONE"),t=a.lastIndexOf("END:VTIMEZONE"),s=0,d="";if(-1!=r&&-1!=t){for(f=t+2;f<a.length;f++)if("\n"==a.charAt(f)){s=f+1;break}d=a.substring(r,s),a=a.substring(0,r)+a.substring(s,a.length)}if(vcalendar_element=a.match(RegExp("\r\n"+vCalendar.re.contentline_CALSCALE,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),version=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_CALSCALE[0]=vCalendar.tplC.contentline_CALSCALE,vCalendar.tplM.contentline_CALSCALE[0]=vCalendar.tplM.contentline_CALSCALE[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_CALSCALE[0]=vCalendar.tplM.contentline_CALSCALE[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),a=a.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(var c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=a.match(c));)vCalendar.tplM.contentline_CALSCALE[0]+=vcalendar_element_related[0].substr(2),a=a.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=a.match(RegExp("\r\n"+vCalendar.re.contentline_VERSION,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),version=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_VERSION[0]=vCalendar.tplC.contentline_VERSION,vCalendar.tplM.contentline_VERSION[0]=vCalendar.tplM.contentline_VERSION[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_VERSION[0]=vCalendar.tplM.contentline_VERSION[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),a=a.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=a.match(c));)vCalendar.tplM.contentline_VERSION[0]+=vcalendar_element_related[0].substr(2),a=a.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=a.match(RegExp("\r\n"+vCalendar.re.contentline_PRODID,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_PRODID[0]=vCalendar.tplC.contentline_PRODID,vCalendar.tplM.contentline_PRODID[0]=vCalendar.tplM.contentline_PRODID[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_PRODID[0]=vCalendar.tplM.contentline_PRODID[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),a=a.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=a.match(c));)vCalendar.tplM.contentline_PRODID[0]+=vcalendar_element_related[0].substr(2),a=a.replace(vcalendar_element_related[0],"\r\n");for(var p=new Array;null!=a.match(vCalendar.pre.vevent);){var i=a.substring(a.indexOf("BEGIN:VEVENT")-2,a.indexOf("END:VEVENT")+"END:VEVENT".length);p[p.length]=i,a=a.replace(i,"")}0==p.length&&console.log("Error: '"+e.id+"': unable to parse vEvent");for(var o=0;o<p.length;o++){var v=p[o],u=v.split("\r\n");if(null==v)return!1;if(null==(parsed="\r\nBEGIN:VEVENT\r\n".match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.beginVEVENT[0]=vCalendar.tplC.beginVEVENT.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+l[u.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.endVEVENT[0]=vCalendar.tplC.endVEVENT.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;if(v="\r\n"+u.slice(2,u.length-1).join("\r\n")+"\r\n",vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_SUMMARY,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_SUMMARY[0]=vCalendar.tplC.contentline_SUMMARY,vCalendar.tplM.contentline_SUMMARY[0]=vCalendar.tplM.contentline_SUMMARY[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_SUMMARY[0]=vCalendar.tplM.contentline_SUMMARY[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_SUMMARY[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_TRANSP,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_TRANSP[0]=vCalendar.tplC.contentline_TRANSP,vCalendar.tplM.contentline_TRANSP[0]=vCalendar.tplM.contentline_TRANSP[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_TRANSP[0]=vCalendar.tplM.contentline_TRANSP[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_TRANSP[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_PRIORITY,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_PRIORITY[0]=vCalendar.tplC.contentline_PRIORITY,vCalendar.tplM.contentline_PRIORITY[0]=vCalendar.tplM.contentline_PRIORITY[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_PRIORITY[0]=vCalendar.tplM.contentline_PRIORITY[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_PRIORITY[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_LOCATION,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_LOCATION[0]=vCalendar.tplC.contentline_LOCATION,vCalendar.tplM.contentline_LOCATION[0]=vCalendar.tplM.contentline_LOCATION[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_LOCATION[0]=vCalendar.tplM.contentline_LOCATION[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_LOCATION[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_URL,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_URL[0]=vCalendar.tplC.contentline_URL,vCalendar.tplM.contentline_URL[0]=vCalendar.tplM.contentline_URL[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_URL[0]=vCalendar.tplM.contentline_URL[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_URL[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");var m=v.match(vCalendar.pre.valarm);if(null!=m){v=v.replace(m[0],"");for(var g="",_=new Array,f=0;f<m[0].length;f++)"END:VALARM"==m[0].substring(f-"END:VALARM".length,f)&&(_[_.length]=g+"\r\n",g=""),g+=m[0][f];for(var C=0;C<_.length;C++)if(checkA=_[C].match(vCalendar.re.valarm),null!=checkA){var T=checkA[0].split("\r\n");if(null==(parsed=("\r\n"+T[0]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.beginVALARM[C]=vCalendar.tplC.beginVALARM.replace(/##:::##group_wd##:::##/g,vcalendar_begin_group=parsed[1]),null==(parsed=("\r\n"+T[T.length-2]+"\r\n").match(vCalendar.pre.contentline_parse)))return!1;if(vCalendar.tplM.endVALARM[C]=vCalendar.tplC.endVALARM.replace(/##:::##group_wd##:::##/g,vcalendar_end_group=parsed[1]),vcalendar_begin_group!=vcalendar_end_group)return!1;if(_[C]="\r\n"+T.slice(1,T.length-2).join("\r\n")+"\r\n",trigger=_[C].match(vCalendar.pre.contentline_TRIGGER),null!=trigger){parsed=(trigger[0]+"\r\n").match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_TRIGGER[C]=vCalendar.tplC.contentline_TRIGGER,vCalendar.tplM.contentline_TRIGGER[C]=vCalendar.tplM.contentline_TRIGGER[C].replace(/##:::##group_wd##:::##/g,parsed[1]);var E=vcalendarSplitParam(parsed[3]),D="";for(f=0;f<E.length;f++)"VALUE=DATE-TIME"!=E[f]&&"VALUE=DURATION"!=E[f]&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_TRIGGER[C]=vCalendar.tplM.contentline_TRIGGER[C].replace(/##:::##params_wsc##:::##/g,D),_[C]=_[C].replace(trigger[0],""),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_TRIGGER[C]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"")}if(note=_[C].match(vCalendar.pre.contentline_NOTE),null!=note&&(parsed=note[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_VANOTE[C]=vCalendar.tplC.contentline_VANOTE,vCalendar.tplM.contentline_VANOTE[C]=vCalendar.tplM.contentline_VANOTE[C].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_VANOTE[C]=vCalendar.tplM.contentline_VANOTE[C].replace(/##:::##params_wsc##:::##/g,parsed[3]),_[C]=_[C].replace(note[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_VANOTE[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(action=_[C].match(vCalendar.pre.contentline_ACTION),null!=action&&(parsed=action[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_ACTION[C]=vCalendar.tplC.contentline_ACTION,vCalendar.tplM.contentline_ACTION[C]=vCalendar.tplM.contentline_ACTION[C].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_ACTION[C]=vCalendar.tplM.contentline_ACTION[C].replace(/##:::##params_wsc##:::##/g,parsed[3]),_[C]=_[C].replace(action[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_ACTION[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");""!=$.trim(_[C])&&(vCalendar.tplM.unprocessedVALARM[C]=_[C])}}if(vcalendar_element=v.match(vCalendar.pre.contentline_NOTE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_NOTE[0]=vCalendar.tplC.contentline_NOTE,vCalendar.tplM.contentline_NOTE[0]=vCalendar.tplM.contentline_NOTE[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_NOTE[0]=vCalendar.tplM.contentline_NOTE[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_NOTE[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(vCalendar.pre.contentline_CLASS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplC.contentline_CLASS,vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplM.contentline_CLASS[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplM.contentline_CLASS[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_CLASS[0]=vCalendar.tplM.contentline_CLASS[0].replace(/##:::##value##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_CLASS[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(vCalendar.pre.contentline_STATUS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),title=vcalendarUnescapeValue(parsed[4]),vCalendar.tplM.contentline_STATUS[0]=vCalendar.tplC.contentline_STATUS,vCalendar.tplM.contentline_STATUS[0]=vCalendar.tplM.contentline_STATUS[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_STATUS[0]=vCalendar.tplM.contentline_STATUS[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_STATUS[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");var h="";if(vcalendar_element=v.match(vCalendar.pre.contentline_RECURRENCE_ID),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);h=parsed[4];vCalendar.tplM.contentline_REC_ID[0]=vCalendar.tplC.contentline_REC_ID,vCalendar.tplM.contentline_REC_ID[0]=vCalendar.tplM.contentline_REC_ID[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=vcalendarSplitParam(parsed[3]),D="",f=0;f<E.length;f++)"VALUE=DATE"!=E[f]&&-1==E[f].indexOf("TZID=")&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_REC_ID[0]=vCalendar.tplM.contentline_REC_ID[0].replace(/##:::##params_wsc##:::##/g,D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_REC_ID[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}""==h&&(h="orig");for(f=-1;null!=v.match(vCalendar.pre.contentline_EXDATE);)if(f++,vcalendar_element=v.match(vCalendar.pre.contentline_EXDATE),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplC.contentline_EXDATE,vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##group_wd##:::##/g,parsed[1]);E=vcalendarSplitParam(parsed[3]),D="";var M="";for(C=0;C<E.length;C++)"VALUE=DATE"!=E[C]&&""!=E[C]&&(D+=";"+E[C]),"VALUE=DATE"==E[C]&&(M=E[C]);if(-1!=M.indexOf("VALUE=DATE")?vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##AllDay##:::##/g,";VALUE=DATE"):vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##AllDay##:::##/g,""),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##TZID##:::##/g,""),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##params_wsc##:::##/g,D),vCalendar.tplM.contentline_EXDATE[f]=vCalendar.tplM.contentline_EXDATE[f].replace(/##:::##value##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_EXDATE[f]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=v.match(vCalendar.pre.contentline_DTEND),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_E_DTEND[0]=vCalendar.tplC.contentline_E_DTEND,vCalendar.tplM.contentline_E_DTEND[0]=vCalendar.tplM.contentline_E_DTEND[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=vcalendarSplitParam(parsed[3]),D="",f=0;f<E.length;f++)"VALUE=DATE"!=E[f]&&-1==E[f].indexOf("TZID=")&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_E_DTEND[0]=vCalendar.tplM.contentline_E_DTEND[0].replace(/##:::##params_wsc##:::##/g,D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_E_DTEND[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=v.match(vCalendar.pre.contentline_DTSTART),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_E_DTSTART[0]=vCalendar.tplC.contentline_E_DTSTART,vCalendar.tplM.contentline_E_DTSTART[0]=vCalendar.tplM.contentline_E_DTSTART[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=vcalendarSplitParam(parsed[3]),D="",f=0;f<E.length;f++)"VALUE=DATE"!=E[f]&&-1==E[f].indexOf("TZID=")&&""!=E[f]&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_E_DTSTART[0]=vCalendar.tplM.contentline_E_DTSTART[0].replace(/##:::##params_wsc##:::##/g,D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_E_DTSTART[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=v.match(vCalendar.pre.contentline_RRULE2),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplC.contentline_RRULE,vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplM.contentline_RRULE[0].replace(/##:::##group_wd##:::##/g,parsed[1]);for(E=parsed[4].split(";"),D="",f=0;f<E.length;f++)-1==E[f].indexOf("FREQ=")&&-1==E[f].indexOf("COUNT=")&&-1==E[f].indexOf("UNTIL=")&&""!=E[f]&&-1==E[f].indexOf("INTERVAL=")&&-1==E[f].indexOf("BYDAY=")&&-1==E[f].indexOf("BYMONTHDAY=")&&-1==E[f].indexOf("BYMONTH=")&&-1==E[f].indexOf("WKST=")&&(D+=";"+E[f]);if(vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplM.contentline_RRULE[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_RRULE[0]=vCalendar.tplM.contentline_RRULE[0].replace(/##:::##value##:::##/g,"##:::##value##:::##"+D),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1])for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_RRULE[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n")}if(vcalendar_element=e.vcalendar.match(RegExp("\r\n"+vCalendar.re.contentline_UID,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_UID[0]=vCalendar.tplC.contentline_UID,vCalendar.tplM.contentline_UID[0]=vCalendar.tplM.contentline_UID[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_UID[0]=vCalendar.tplM.contentline_UID[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_UID[0]=vCalendar.tplM.contentline_UID[0].replace(/##:::##uid##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_UID[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_CREATED,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_CREATED[h]=vCalendar.tplC.contentline_CREATED,vCalendar.tplM.contentline_CREATED[h]=vCalendar.tplM.contentline_CREATED[h].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_CREATED[h]=vCalendar.tplM.contentline_CREATED[h].replace(/##:::##params_wsc##:::##/g,parsed[3]),vCalendar.tplM.contentline_CREATED[h]=vCalendar.tplM.contentline_CREATED[h].replace(/##:::##value##:::##/g,parsed[4]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_CREATED[h]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_LM,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_LM[0]=vCalendar.tplC.contentline_LM,vCalendar.tplM.contentline_LM[0]=vCalendar.tplM.contentline_LM[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_LM[0]=vCalendar.tplM.contentline_LM[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_LM[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");if(vcalendar_element=v.match(RegExp("\r\n"+vCalendar.re.contentline_DTSTAMP,"mi")),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),vCalendar.tplM.contentline_DTSTAMP[0]=vCalendar.tplC.contentline_DTSTAMP,vCalendar.tplM.contentline_DTSTAMP[0]=vCalendar.tplM.contentline_DTSTAMP[0].replace(/##:::##group_wd##:::##/g,parsed[1]),vCalendar.tplM.contentline_DTSTAMP[0]=vCalendar.tplM.contentline_DTSTAMP[0].replace(/##:::##params_wsc##:::##/g,parsed[3]),v=v.replace(vcalendar_element[0],"\r\n"),""!=parsed[1]))for(c=RegExp("\r\n"+parsed[1].replace(".","\\..*")+"\r\n","im");null!=(vcalendar_element_related=v.match(c));)vCalendar.tplM.contentline_DTSTAMP[0]+=vcalendar_element_related[0].substr(2),v=v.replace(vcalendar_element_related[0],"\r\n");0==v.indexOf("\r\n")&&(v=v.substring(2,v.length-2)),v.lastIndexOf("\r\n")!=v.length-2&&(v+="\r\n"),vCalendar.tplM.unprocessedVEVENT[h]=v}0==a.indexOf("\r\n")&&(a=a.substring(2,a.length-2)),a.lastIndexOf("\r\n")!=a.length-2&&(a+="\r\n"),vCalendar.tplM.unprocessedVTIMEZONE=d,vCalendar.tplM.unprocessed=a}function parseAlarmWeek(e){return 604800*(e=e.substring(e.indexOf("P")+1)).substring(0,e.indexOf("W"))*1e3+"W"}function parseAlarmDay(e){var a="",n="D",l=0;return l=86400*(a=(e=e.substring(e.indexOf("P")+1)).substring(0,e.indexOf(n)))*1e3,-1!=(e=e.substring(e.indexOf(n+1))).indexOf("T")&&(a=parseAlarmTime(e))&&(n=a.substring(a.length-1),l+=a=a.substring(0,a.length-1)),l+n}function parseAlarmTime(e){var a="",n="",l=0,r=0;for(e=e.substring(e.indexOf("T")+1);""!=e;)-1!=e.indexOf("H")?(n="H",l=3600):-1!=e.indexOf("M")?(n="M",l=60):-1!=e.indexOf("S")&&(n="S",l=1),a=e.substring(0,e.indexOf(n)),e=e.substring(e.indexOf(n)+1),r+=a*l;return""!=n&&1e3*r+n}function getDateFromDay(e,a,n,l){var r=e.startMonth-1,t=e.startDay,s=e.startCount,d=e.dtStart.parseComnpactISO8601(l).getHours(),c=e.dtStart.parseComnpactISO8601().getMinutes();7==t&&(t=0);var p=new Date(a.getFullYear(),r,1,23,59,0);n&&p.setFullYear(p.getFullYear()-1);var i=p.getDay();if(i!=t){var o=(1+t-i)%7;o<=0?p.setDate(o+7):p.setDate(o)}if(s>0)var v=7*(parseInt(s)-1),u=new Date(p.getFullYear(),p.getMonth(),p.getDate()+v,d,c);else{var m=21+p.getDate();if(new Date(a.getFullYear(),r,m+7,23,59,0).getMonth()!=r)var g=m;else g=m+7;v=7*(s+1),u=new Date(p.getFullYear(),p.getMonth(),g+v,d,c)}return u>a&&!n&&(u=getDateFromDay(e,a,!0).startDate),{offsetFrom:e.tzOffsetFROM,offsetTo:e.tzOffsetTO,startDate:u}}function vcalendarToData(e,a,n){var l=a.vcalendar,r=new Array,t=l.match(vCalendar.pre.contentline_CALSCALE);if(null!=t&&(calscale=t[0].match(vCalendar.pre.contentline_parse)[4],"GREGORIAN"!=calscale))return console.log("Error:'"+a.uid+"': Unsupported calscale in:"+l),!1;var s=l.match(vCalendar.pre.contentline_VERSION);if(null!=s){var d=s[0].match(vCalendar.pre.contentline_parse)[4];if("2.0"!=d)return console.log("Error:'"+a.uid+"': Unsupported version ("+d+") in:"+l),!1}var c=l.indexOf("BEGIN:VTIMEZONE"),p=l.lastIndexOf("END:VTIMEZONE"),i=0,o=a.uid.substring(0,a.uid.lastIndexOf("/")+1),v=a.uid.substring(a.uid.lastIndexOf("/")+1,a.uid.length),u=!1,m=!1;if(!n){var g=findEventInArray(a.uid,!0);if(""!=g&&g.etag!=a.etag){for(var _=0;_<g.alertTimeOut.length;_++)clearTimeout(g.alertTimeOut[_]);if(deleteEventFromArray(a.uid),""!=$("#show").val()&&$("#show").val()==a.uid)if("true"==$("#repeatEvent").val()||""!=$("#recurrenceID").val()){var f=globalCalEvent.title;showEventForm(null,null,{title:f,id:a.uid},globalJsEvent,"show","",!0),$("#editAll").css("visibility","hidden"),$("#editFuture").css("visibility","hidden"),$("#editOnlyOne").css("visibility","hidden"),$("#repeatConfirmBoxContent").html("<b>"+f+"</b> "+localization[globalInterfaceLanguage].repeatChangeTxt),$("#repeatConfirmBoxQuestion").html(localization[globalInterfaceLanguage].repeatChangeTxtClose)}else m=!0;u=!0}}if(-1!=c&&-1!=p){for(_=p+2;_<l.length;_++)if("\n"==l.charAt(_)){i=_+1;break}vTimeZone=l.substring(c,i),le=l.substring(0,c)+l.substring(i,l.length)}for(var C=new Array;null!=l.match(vCalendar.pre.vevent);){if("\r\n"==l.substring(l.indexOf("BEGIN:VEVENT")-2,l.indexOf("BEGIN:VEVENT"))){var T=l.substring(l.indexOf("BEGIN:VEVENT")-2,l.indexOf("END:VEVENT")+"END:VEVENT".length);l=l.replace(T,"")}else{T=l.substring(l.indexOf("BEGIN:VEVENT"),l.indexOf("END:VEVENT")+"END:VEVENT".length);l=l.replace(T,""),T+="\r\n"}var E=T.match(vCalendar.pre.contentline_RECURRENCE_ID),D=T.match(vCalendar.pre.contentline_UID);null!=D&&null!=E&&(C[C.length]=E[0].match(vCalendar.pre.contentline_parse)[4]+";"+D[0].match(vCalendar.pre.contentline_parse)[4]),r[r.length]=T}0==r.length&&console.log("Error: '"+a.uid+"': unable to parse vEvent");for(var M=0;M<r.length;M++){var A="",O="",R="",b="",S="",I=!1,y="",N="",V="",x="",w="",L=!1,U=!1,Z=new Array,Y=new Array,k=new Array,F="",H=0,B="local",P="",z="",G="",W="",X="",K="",Q="",j=!0,J="",q="0",ee="",ae=new Array,ne="",le=(new Array,r[M]);null!=(J=le.match(vCalendar.pre.contentline_UID))&&(J=J[0].match(vCalendar.pre.contentline_parse)[4]);for(var re=new Array,te=null,se=new Array,de=le+"";null!=de.match(vCalendar.pre.contentline_EXDATE);)te=de.match(vCalendar.pre.contentline_EXDATE),se[se.length]=te[0],de=de.replace(te,"\r\n");if(vcalendar_element=le.match(vCalendar.pre.contentline_RRULE2),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);(ae=parsed[4].split(";")).length>0&&(U=!0);for(_=0;_<ae.length;_++)if(-1!=ae[_].indexOf("FREQ="))y=ae[_].split("=")[1];else if(-1!=ae[_].indexOf("INTERVAL="))N=ae[_].split("=")[1];else if(-1!=ae[_].indexOf("COUNT=")){if(0==(w=ae[_].split("=")[1])){j=!1;break}if(isNaN(w)){j=!1;break}}else if(-1!=ae[_].indexOf("UNTIL="))L=!0,w=ae[_].split("=")[1];else if(-1!=ae[_].indexOf("WKST="))W=ae[_].split("=")[1].replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0),null!=globalSettings.mozillasupport.value&&globalSettings.mozillasupport.value&&(W="");else if(-1!=ae[_].indexOf("BYMONTHDAY="))V=ae[_].split("=")[1];else if(-1!=ae[_].indexOf("BYDAY=")&&(x=(x=ae[_].split("=")[1]).replace(/\d*MO/,1).replace(/\d*TU/,2).replace(/\d*WE/,3).replace(/\d*TH/,4).replace(/\d*FR/,5).replace(/\d*SA/,6).replace(/\d*SU/,0).split(",")).length>1&&("MONTHLY"==y||"YEARLY"==y))return console.log("Error:'"+a.uid+"': Unsupported recurrence rule in event:"+le),!1;if(!j)continue;N||(N=1)}if(vcalendar_element=le.match(vCalendar.pre.contentline_DTSTART),null==vcalendar_element)return!1;parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);var ce=O=parsed[4];-1==ce.indexOf("T")?(ce=ce.substring(0,4)+"-"+ce.substring(4,6)+"-"+ce.substring(6,8),I=!0):(ce=ce.substring(0,4)+"-"+ce.substring(4,6)+"-"+ce.substring(6,8)+"T"+ce.substring(9,11)+":"+ce.substring(11,13)+":"+ce.substring(13,15),I=!1);var pe=$.fullCalendar.parseDate(ce);if(null==pe)return!1;if("Invalid Date"==pe.toString())return!1;if(I)B=globalSessionTimeZone;else{for(parsed_value=vcalendarSplitParam(parsed[3]),h=1;h<parsed_value.length;h++)""!=parsed_value[h]&&(ne=parsed_value[h]);if(ne=ne.split("="),"Z"==O.charAt(O.length-1)&&(B="UTC"),ne.length>1||"UTC"==B)"UTC"!=B&&(B=$.trim(ne[1])),null!=(Ue=checkTimezone(B))&&(B=Ue),globalSettings.timezonesupport.value&&B in timezones&&(F=getOffsetByTZ(B,pe),H=-1*getLocalOffset(pe)*1e3-1e3*F.getSecondsFromOffset());else-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=B&&"local"!=B&&-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push(B),processedTimezones.push(B))}if(P=$.fullCalendar.parseDate(ce),a.start=$.fullCalendar.parseDate(ce),O=$.fullCalendar.parseDate(ce),H&&(a.start.setTime(a.start.getTime()+H),O.setTime(O.getTime()+H)),null!=se)for(var ie=0;ie<se.length;ie++){var oe=(se[ie]+"\r\n").match(vCalendar.pre.contentline_parse)[4];if(-1!=oe.indexOf("T")&&-1!=oe.indexOf("Z"))var ve=oe.parseComnpactISO8601().setSeconds(-1*getLocalOffset(oe.parseComnpactISO8601()));else if(-1!=oe.indexOf("T")&&-1==oe.indexOf("Z"))ve=oe.parseComnpactISO8601();else{-1!=ce.indexOf("T")&&(oe+="T"+$.fullCalendar.formatDate(O,"HHmmss"));ve=oe.parseComnpactISO8601()}re[re.length]=new Date(ve).toString()}var ue=le.match(vCalendar.pre.valarm);if(null!=ue){le=le.replace(ue[0],"");var me="",ge=new Array;for(_=0;_<ue[0].length;_++)"END:VALARM"==ue[0].substring(_-"END:VALARM".length,_)&&(ge[ge.length]=me+"\r\n",me=""),me+=ue[0][_];for(ie=0;ie<ge.length;ie++)if(checkA=ge[ie].match(vCalendar.re.valarm),null!=checkA){if(action=ge[ie].match(vCalendar.pre.contentline_ACTION),null==action)break;if(parsed=action[0].match(vCalendar.pre.contentline_parse),trigger=ge[ie].match(vCalendar.pre.contentline_TRIGGER),null==trigger)break;if(parsed=(trigger[0]+"\r\n").match(vCalendar.pre.contentline_parse),null!=parsed){var _e="",fe="";if(null!=(Ne=parsed[4]).match(vCalendar.pre["date-time-value"])){if(parsed[3])var Ce=parsed[3].split("=");var Te=$.fullCalendar.parseDate(Ne.substring(0,4)+"-"+Ne.substring(4,6)+"-"+Ne.substring(6,8)+"T"+Ne.substring(9,11)+":"+Ne.substring(11,13)+":"+Ne.substring(13,15));if("Z"==Ne.charAt(Ne.length-1)&&(fe="UTC"),Ce.length>1||"UTC"==fe){if("UTC"!=fe&&";TZID"==Ce[0]&&(fe=$.trim(Ce[1])),null!=(Ue=checkTimezone(fe))&&(fe=Ue),globalSettings.timezonesupport.value&&fe in timezones){var Ee=getOffsetByTZ(fe,Te);_e=1e3*getOffsetByTZ(B,Te).getSecondsFromOffset()-1e3*Ee.getSecondsFromOffset()}}else-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=fe&&"local"!=fe&&-1==processedTimezones.indexOf(fe)&&(-1==timeZonesEnabled.indexOf(fe)&&timeZonesEnabled.push(fe),processedTimezones.push(fe)),""!=_e&&Te.setTime(Te.getTime()+_e),Z[ie]=$.fullCalendar.formatDate(Te,"yyyy-MM-dd'T'HH:mm:ss")}else Z[ie]=0,-1!=Ne.indexOf("W")?Z[ie]=parseAlarmWeek(Ne):-1!=Ne.indexOf("D")?Z[ie]=parseAlarmDay(Ne):-1!=Ne.indexOf("T")&&(Z[ie]=parseAlarmTime(Ne)),"-"==parsed[4].charAt(0)?Z[ie]="-"+Z[ie]:Z[ie]="+"+Z[ie]}noteA=ge[ie].match(vCalendar.pre.contentline_NOTE),null!=noteA?(parsed=noteA[0].match(vCalendar.pre.contentline_parse),Y[ie]=parsed[4]):Y[ie]="Default note"}}vcalendar_element=le.match(vCalendar.pre.contentline_LOCATION),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),S=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_NOTE),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),A=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_SUMMARY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),b=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_PRIORITY),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),q=vcalendarUnescapeValue(parsed[4]));for(var De=0,he=0;he<globalResourceCalDAVList.collections.length;he++)if(void 0!==globalResourceCalDAVList.collections[he].uid&&globalResourceCalDAVList.collections[he].uid==e.uid){De=he;break}var Me=(De.pad(String(globalResourceCalDAVList.collections.length).length)+b).toLowerCase();vcalendar_element=le.match(vCalendar.pre.contentline_CLASS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),X=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_STATUS),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),ee=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_TRANSP),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),K=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_URL),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),Q=vcalendarUnescapeValue(parsed[4])),vcalendar_element=le.match(vCalendar.pre.contentline_RECURRENCE_ID),null!=vcalendar_element&&(parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse),G=parsed[4]);var Ae=!1,Oe=0;if(vcalendar_element=le.match(vCalendar.pre.contentline_DTEND),null!=vcalendar_element){parsed=vcalendar_element[0].match(vCalendar.pre.contentline_parse);var Re=R=parsed[4];if(-1==Re.indexOf("T")){Re=Re.substring(0,4)+"-"+Re.substring(4,6)+"-"+Re.substring(6,8);var be=$.fullCalendar.parseDate(Re),Se=new Date(be.getTime());-1==ce.indexOf("T")&&Se.setDate(Se.getDate()-1),Re=$.fullCalendar.formatDate(Se,"yyyy-MM-dd"),I=!0,-1!=ce.indexOf("T")&&(I=!1,Re+="T00:00:00","UTC"==B&&(Re+="Z"))}else Re=Re.substring(0,4)+"-"+Re.substring(4,6)+"-"+Re.substring(6,8)+"T"+Re.substring(9,11)+":"+Re.substring(11,13)+":"+Re.substring(13,15),I=!1}else{var Ie=le.match(vCalendar.pre["dur-value"]);if(null!=Ie){var ye=(Ie[0]+"\r\n").match(vCalendar.pre.contentline_parse);if(null!=ye){var Ne=ye[4],Ve=0;-1!=Ne.indexOf("W")?Ve=parseAlarmWeek(Ne):-1!=Ne.indexOf("D")?Ve=parseAlarmDay(Ne):-1!=Ne.indexOf("T")&&(Ve=parseAlarmTime(Ne)),Ve="-"==parsed[4].charAt(0)?"-"+Ve:"+"+Ve,Oe=parseInt(Ve.substring(1,Ve.length-1),10),Ae=!0}}}if(Ae){var xe="";I?(xe=$.fullCalendar.parseDate(ce+"T00:00:00")).setMilliseconds(-1):xe=$.fullCalendar.parseDate(ce);var we=new Date(xe.getTime()+Oe);Re=$.fullCalendar.formatDate(we,"yyyy-MM-dd'T'HH:mm:ss")}void 0!==Re&&""!=Re&&null!=Re||(Re=ce);var Le=$.fullCalendar.parseDate(Re);if(null==Le)return!1;if("Invalid Date"==Le.toString())return!1;if(I)B=globalSessionTimeZone;else{var Ue;if("Z"==R.charAt(R.length-1)&&(B="UTC"),ne.length>1||"UTC"==B)"UTC"!=B&&(B=$.trim(ne[1])),null!=(Ue=checkTimezone(B))&&(B=Ue),globalSettings.timezonesupport.value&&B in timezones&&(F=getOffsetByTZ(B,Le),H=-1*getLocalOffset(Le)*1e3-1e3*F.getSecondsFromOffset());else-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push("local"),processedTimezones.push("local"));""!=B&&"local"!=B&&-1==processedTimezones.indexOf(B)&&(-1==timeZonesEnabled.indexOf(B)&&timeZonesEnabled.push(B),processedTimezones.push(B))}if(z=$.fullCalendar.parseDate(Re),a.end=$.fullCalendar.parseDate(Re),R=$.fullCalendar.parseDate(Re),H&&(a.end.setTime(a.end.getTime()+H),R.setTime(R.getTime()+H)),-1!=globalVisibleCalDAVCollections.indexOf(o)||u||n)if(U){var $e=new Date(globalToLoadedLimit.getTime());$e.setDate($e.getDate()+14);var Ze=le.match(vCalendar.pre.contentline_RRULE2)[0].match(vCalendar.pre.contentline_parse)[4];if(a.isRepeat=!0,P)var Ye=new Date(P.getTime());else Ye=new Date(O.getTime());if(z)var ke=new Date(z.getTime());else ke=new Date(R.getTime());var Fe=new Date(Ye.getTime()),He=new Date(ke.getTime()),Be="",Pe="",ze="";if(""!==w){if(L){if(-1!=w.indexOf("T")){var Ge=w.substring(0,4)+"-"+w.substring(4,6)+"-"+w.substring(6,8)+"T"+w.substring(9,11)+":"+w.substring(11,13)+":"+w.substring(13,15),We=$.fullCalendar.parseDate(Ge);if(null==We)return!1;if("Invalid Date"==We.toString())return!1;if(!I&&(globalSettings.timezonesupport.value&&B in timezones&&(F=getOffsetByTZ(B,We)),F)){H=1e3*F.getSecondsFromOffset();We.setTime(We.getTime()+H)}Be=new Date(We.getTime())}else(Be=$.fullCalendar.parseDate(w.substring(0,4)+"-"+w.substring(4,6)+"-"+w.substring(6,8))).setHours(P.getHours()),Be.setMinutes(P.getMinutes()),Be.setSeconds(P.getSeconds());ze=""}else Be="",ze=w;Pe=Be,a.untilDate=Be}else Be=new Date($e.getTime()),Pe="",a.untilDate="never";var Xe=0,Ke=0;if(!a.isDrawn){if(Z.length>0){new Date;e.ignoreAlarms||(k=setAlertTimeouts(!1,Z,O,R,{allDay:I,title:b},!0,a.uid))}Ke++;var Qe=isInRecurrenceArray(Ye,J,C,B);if(re.length>0&&-1!=re.indexOf(Ye.toString())&&(Qe=!0),!Qe){Xe++;var je=new items(a.etag,O,R,b,I,a.uid,o,v,A,a.displayValue,Z,Y,Pe,y,N,ze,Fe,He,V,Xe,Ke,le,S,k,B,P,z,x,G,W,X,K,Q,Me,q,ee,Ze);globalEventList.displayEventsArray[o].splice(globalEventList.displayEventsArray[o].length,0,je)}}generateRepeatInstances({untilDate:Pe,repeatStart:Ye,futureRLimit:$e,stringUID:J,recurrence_id_array:C,exDates:re,alertTime:Z,ignoreAlarms:e.ignoreAlarms,items:new items(a.etag,Ye,ke,b,I,a.uid,o,v,A,a.displayValue,Z,Y,Pe,y,N,ze,Fe,He,V,Xe,Ke,le,S,k,B,P,z,x,G,W,X,K,Q,Me,q,ee,Ze)})}else{e.ignoreAlarms||(k=setAlertTimeouts(!1,Z,O,R,{allDay:I,title:b},!0,a.uid));je=new items(a.etag,O,R,b,I,a.uid,o,v,A,a.displayValue,Z,Y,"","","","","","","","","",le,S,k,B,P,z,x,G,W,X,K,Q,Me,q,ee,Ze);u&&m&&showEventForm(null,null,je,globalJsEvent,"show",""),globalEventList.displayEventsArray[o].splice(globalEventList.displayEventsArray[o].length,0,je)}}a.isDrawn=!0}function notRFCDataToRFCData(e){return null==e.match(RegExp("\r","m"))&&(e=e.replace(RegExp("\n","gm"),"\r\n")),"\n"!=(e=(e=e.replace(RegExp("(\r\n)+","gm"),"\r\n")).replace(RegExp("\r\n"+vCalendar.re.WSP,"gm"),""))[e.length-1]&&(e+="\r\n"),e}function vCalendarCleanup(e){return e=notRFCDataToRFCData(e)}String.prototype.parseComnpactISO8601=function(e){if(this.length>=15)var a=this.substring(0,4)+"/"+this.substring(4,6)+"/"+this.substring(6,8)+" "+this.substring(9,11)+":"+this.substring(11,13)+":"+this.substring(13,15);else a=this.substring(0,4)+"/"+this.substring(4,6)+"/"+this.substring(6,8)+" 00:00:00";var n=Date.parse(a);return!isNaN(n)&&new Date(n)},String.prototype.getSecondsFromOffset=function(){if(this.length>=5){var e=this.substring(1,3),a=this.substring(3,5),n="00";this.length>=7&&(n=this.substring(5,7));var l=60*parseInt(e,10)*60+60*parseInt(a,10)+parseInt(n,10);return"-"==this.charAt(0)&&(l*=-1),isNaN(l)?0:l}return 0},Array.prototype.indexElementOf=function(e){for(var a=0;a<this.length;a++)if(-1!=this[a].indexOf(e))return a;return-1};