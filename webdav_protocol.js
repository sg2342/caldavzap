function netVersionCheck(){$.ajax({type:"GET",url:globalVersionCheckURL,cache:!1,crossDomain:!1,timeout:3e4,beforeSend:function(e){e.setRequestHeader("X-client",globalXClientHeader)},contentType:"text/xml; charset=utf-8",processData:!0,data:"",dataType:"xml",error:function(e,l){return console.log("Error: [netVersionCheck: 'GET "+globalVersionCheckURL+"'] code: '"+e.status+"' status: '"+l+"'"),!1},success:function(e,l,t){var a=$(t.responseXML).find("updates").find(globalAppName.toLowerCase()),o=a.attr("type"),r=a.attr("homeURL"),n=a.attr("version"),s="undefined"==typeof globalEnableDevelBuilds||1!=globalEnableDevelBuilds?a.attr("build_no"):a.attr("dev_build_no");if(null==o||""==o||null==r||""==r||null==n||""==n||null==s||""==s)return!1;var i=s.match(RegExp("^([0-9]+)$"));if(null==i)return!1;if(globalBuildNo<parseInt(i[1])){var d=!1;if(0==globalNewVersionNotifyUsers.length)d=!0;else for(var c=0;c<globalAccountSettings.length;c++)if(-1!=globalNewVersionNotifyUsers.indexOf(globalAccountSettings[c].userAuth.userName)){d=!0;break}1==d&&($("div.update_h").html(localization[globalInterfaceLanguage].updateNotification.replace("%name%",globalAppName).replace("%new_ver%",'<span id="newversion" class="update_h"></span>').replace("%curr_ver%",'<span id="version" class="update_h"></span>').replace("%url%",'<span id="homeurl" class="update_h" onclick=""></span>')),$("div.update_h").find("span#version").text(globalVersion),$("div.update_h").find("span#newversion").text(n),$("div.update_h").find("span#homeurl").attr("onclick","window.open('"+r+"')"),$("div.update_h").find("span#homeurl").text(r),setTimeout(function(){var e=$("div.update_d").width();$("div.update_d").css("width","0px"),$("div.update_d").css("display",""),$("div.update_d").animate({width:"+="+e+"px"},500)},5e3))}}})}function netCheckAndCreateConfiguration(e){$.ajax({type:"PROPFIND",url:e.href,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=globalLoginUsername&&""!=globalLoginPassword&&e.setRequestHeader("Authorization",basicAuth(globalLoginUsername,globalLoginPassword)),e.setRequestHeader("X-client",globalXClientHeader),e.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?globalLoginUsername:null,password:1==globalSettings.usejqueryauth.value?globalLoginPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop><D:current-user-principal/></D:prop></D:propfind>',dataType:"xml",error:function(l,t){return console.log("Error: [netCheckAndCreateConfiguration: 'PROPFIND "+e.href+"'] code: '"+l.status+"' status: '"+t+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),$("#LoginLoader").fadeOut(1200),!1},success:function(l,t,a){var o=0;if($(a.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("status").text().match(RegExp("200 OK$"))&&("undefined"==typeof globalAccountSettings&&(globalAccountSettings=[]),globalAccountSettings[globalAccountSettings.length]=$.extend({},e),globalAccountSettings[globalAccountSettings.length-1].type="network","function"==typeof globalAccountSettingsHook?globalAccountSettings[globalAccountSettings.length-1].href=globalAccountSettingsHook(e.href,globalLoginUsername):globalAccountSettings[globalAccountSettings.length-1].href=e.href+globalLoginUsername+"/",globalAccountSettings[globalAccountSettings.length-1].userAuth={userName:globalLoginUsername,userPassword:globalLoginPassword},o++,null!=e.additionalResources&&e.additionalResources.length>0))for(var r=0;r<e.additionalResources.length;r++)globalLoginUsername!=e.additionalResources[r]&&(globalAccountSettings[globalAccountSettings.length]=$.extend({},e),globalAccountSettings[globalAccountSettings.length-1].type="network",globalAccountSettings[globalAccountSettings.length-1].href=e.href+e.additionalResources[r]+"/",globalAccountSettings[globalAccountSettings.length-1].userAuth={userName:globalLoginUsername,userPassword:globalLoginPassword},o++);o?globalAccountSettings[0].delegation?DAVresourceDelegation(globalAccountSettings[0],0,0):(isAvaible("CardDavMATE")&&runCardDAV(),isAvaible("CalDavZAP")&&runCalDAV(),isAvaible("Projects")&&runProjects(),isAvaible("Settings")&&runSettings(),globalResourceNumber=globalAccountSettings.length,loadAllResources()):$("#LoginLoader").fadeOut(1200)}})}function netLoadConfiguration(e){$.ajax({type:"GET",url:e.href+"?browser_date="+$.datepicker.formatDate("yyyy-MM-dd",new Date)+(1==ignoreServerSettings?"&ignore_settings=1":""),cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=globalLoginUsername&&""!=globalLoginPassword&&e.setRequestHeader("Authorization",basicAuth(globalLoginUsername,globalLoginPassword)),e.setRequestHeader("X-client",globalXClientHeader)},username:1==globalSettings.usejqueryauth.value?globalLoginUsername:null,password:1==globalSettings.usejqueryauth.value?globalLoginPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:"",dataType:"xml",error:function(l,t){return console.log("Error: [loadConfiguration: 'GET "+e.href+"'] code: '"+l.status+"' status: '"+t+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),$("#LoginLoader").fadeOut(1200),!1},success:function(e,l,t){"undefined"==typeof globalAccountSettings&&(globalAccountSettings=[]);var a=0,o=new RegExp("^re(\\|[^:]*|):(.+)$");if($(t.responseXML).children("resources").children("resource").each(function(e,l){if(1==$(l).children().filterNsNode("type").children().filterNsNode("addressbook").length||1==$(l).children().filterNsNode("type").children().filterNsNode("calendar").length){var t=$(l).children("href").text(),r=""!=(L=$(l).children("hreflabel").text())&&"null"!=L?L:null,n=$(l).children("userauth").children("username").text(),s=$(l).children("userauth").children("password").text(),i=$(l).children("timeout").text(),d=$(l).children("locktimeout").text(),c=new Array;1==$(l).children().filterNsNode("type").children().filterNsNode("addressbook").length&&(c[c.length]="addressbook"),1==$(l).children().filterNsNode("type").children().filterNsNode("calendar").length&&(c[c.length]="calendar");var u="true"==(L=$(l).children("withcredentials").text())||"yes"==L||"1"==L,g="false"!=(L=$(l).children("crossdomain").text())&&"no"!=L&&"0"!=L,b="true"==(L=$(l).find("settingsaccount").text())||"yes"==L||"1"==L,p="false"!=(L=$(l).find("checkcontenttype").text())&&"no"!=L&&"0"!=L,v="true"==(L=$(l).find("ignorebound").text())||"yes"==L||"1"==L,h=null;if("true"==(L=$(l).children("forcereadonly")).text())h=!0;else{var f=[];if(L.children("collection").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?f[f.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):f[f.length]=$(l).text()}),f.length>0)h=f}var m=!1;if("true"==(L=$(l).children("delegation")).text())m=!0;else{var A=[];if(L.children("resource").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?A[A.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):A[A.length]=$(l).text()}),A.length>0)m=A}var C=!1;"true"==(L=$(l).children("extendeddelegation")).text()&&(C=!0);var D=!1;if("true"==(L=$(l).children("ignorealarms")).text())D=!0;else{var y=[];if(L.children("collection").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?y[y.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):y[y.length]=$(l).text()}),y.length>0)D=y}var L,S=[];""!=(L=$(l).children("backgroundcalendars")).text()&&L.children("collection").each(function(e,l){null!=(matched=$(l).text().match(o))&&3==matched.length?S[S.length]=new RegExp(matched[2],matched[1].substring(matched[1].length>0?1:0)):S[S.length]=$(l).text()}),globalAccountSettings[globalAccountSettings.length]={type:"network",href:t,hrefLabel:r,crossDomain:g,settingsAccount:b,checkContentType:p,forceReadOnly:h,withCredentials:u,userAuth:{userName:n,userPassword:s},timeOut:i,lockTimeOut:d,delegation:m,extendedDelegation:C,ignoreAlarms:D,backgroundCalendars:S,collectionTypes:c,ignoreBound:v},a++}}),a){var r=$(t.responseXML).children("resources").children("cache_data");r.length&&(globalXMLCache=r),globalAccountSettings[0].delegation?DAVresourceDelegation(globalAccountSettings[0],0,0):(isAvaible("CardDavMATE")&&runCardDAV(),isAvaible("CalDavZAP")&&runCalDAV(),isAvaible("Projects")&&runProjects(),isAvaible("Settings")&&runSettings(),globalResourceNumber=globalAccountSettings.length,loadAllResources())}else $("#LoginLoader").fadeOut(1200)}})}function netSaveProperty(e,l,t,a){var o='<?xml version="1.0" encoding="utf-8"?><D:propertyupdate xmlns:D="DAV:"><D:set><D:prop><I:'+t+' xmlns:I="'+l+'">'+a+"</I:"+t+"></D:prop></D:set></D:propertyupdate>";$.ajax({type:"PROPPATCH",url:e.url+e.href,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:o,dataType:"xml",error:function(l,a){return console.log("Error: [netSaveProperty: 'PROPPATCH "+e.url+e.href+"'] code: '"+l.status+"' status: '"+a+"'"+(0==l.status?" (this error code usually means network connection error, or your browser is trying to make a cross domain query, but it is not allowed by the destination server or the browser itself)":"")),"calendar-color"==t?"vevent"==e.listType?($("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",e.ecolor),$("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",e.ecolor)):($("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",e.ecolor),$("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",e.ecolor)):"addressbook-color"==t&&($("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').find(".resourceCardDAVColor").css("background",e.color),$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",e.color)),!1},success:function(l,a,o){var r;if("calendar-color"==t){var n=null;"vevent"==e.listType?(r=$("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("get").toHexString(),null!=e.fcSource&&(e.fcSource.backgroundColor=hexToRgba(r,.9),e.fcSource.borderColor=r,e.fcSource.textColor=checkFontColor(r)),null!=(n=globalResourceCalDAVList.getTodoCollectionByUID(e.uid))&&($("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",r),$("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",r),null!=n.fcSource&&(n.fcSource.backgroundColor=hexToRgba(r,.9),n.fcSource.borderColor=r))):(r=$("#ResourceCalDAVTODOList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("get").toHexString(),null!=e.fcSource&&(e.fcSource.backgroundColor=hexToRgba(r,.9),e.fcSource.borderColor=r),null!=(n=globalResourceCalDAVList.getEventCollectionByUID(e.uid))&&($("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".resourceCalDAVColor").css("background",r),$("#ResourceCalDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("set",r),null!=n.fcSource&&(n.fcSource.backgroundColor=hexToRgba(r,.9),n.fcSource.borderColor=r,n.fcSource.textColor=checkFontColor(r)))),e.ecolor=r,null!=n&&(n.ecolor=r),"vevent"!=e.listType&&null==n||$("#calendar").fullCalendar("refetchEvents"),"vtodo"!=e.listType&&null==n||$("#todoList").fullCalendar("refetchEvents")}else if("addressbook-color"==t){r=$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').find(".colorPicker").spectrum("get").toHexString(),e.color=r,$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').parent().find(".contact_group").find("div[data-id]").length>0&&$("#ResourceCardDAVList").find('[data-id="'+e.uid+'"]').parent().find(".contact_group").find("div[data-id]").find(".resourceCardDAVGroupColor").css("background",r),globalAddressbookList.applyABFilter(dataGetChecked("#ResourceCardDAVList"),!1);var s=$("#vCardEditor").find('[data-attr-name="_DEST_"]').find("option:selected").attr("data-type"),i=globalResourceCardDAVList.getCollectionByUID(s);$("#ABContactColor").css("background-color",i.color)}}})}function DAVresourceDelegation(e,l,t){globalCalDAVResourceSync=!1;var a,o=new RegExp("^(https?://)([^/]+)(.*)","i"),r=e.href.match(o),n=r[1]+r[2],s=(r[1],e.userAuth.userName,r[2],r[1]+e.userAuth.userName+"@"+r[2]+r[3]),i="",d="";function c(a,o,s){"undefined"==typeof globalAccountSettings&&(globalAccountSettings=[]);var i=r[1]+r[2],d=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop"),c=new Array;c[c.length]=$(d).children().filterNsNode("calendar-proxy-read-for"),c[c.length]=$(d).children().filterNsNode("calendar-proxy-write-for");for(var u=0;u<c.length;u++)c[u].children().filterNsNode("response").each(function(l,t){for(var a=$(t).children().filterNsNode("href").text(),o=!1,r=0;r<globalAccountSettings.length;r++)decodeURIComponent(globalAccountSettings[r].href)==i+a&&(o=!0);if(o||(globalAccountSettings[globalAccountSettings.length]=$.extend({},e),globalAccountSettings[globalAccountSettings.length-1].type=e.type,globalAccountSettings[globalAccountSettings.length-1].href=decodeURIComponent(i+a),globalAccountSettings[globalAccountSettings.length-1].userAuth={userName:e.userAuth.userName,userPassword:e.userAuth.userPassword}),void 0!==e.extendedDelegation&&e.extendedDelegation){$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-user-address-set").children().each(function(e,l){var t=$(l).text();-1!=t.indexOf("mailto:")&&(globalAccountSettings[globalAccountSettings.length-1].principalEmail=t.split("mailto:")[1])});var s=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("addressbook-home-set").children().filterNsNode("href").text();""==s&&(s=$(t).children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=s.match(RegExp("^https?://","i"))?globalAccountSettings[globalAccountSettings.length-1].abhref=s:globalAccountSettings[globalAccountSettings.length-1].abhref=n+s;var d=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-home-set").children().filterNsNode("href").text();""==d&&(d=$(t).children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=d.match(RegExp("^https?://","i"))?globalAccountSettings[globalAccountSettings.length-1].cahref=d:globalAccountSettings[globalAccountSettings.length-1].cahref=n+d}});if(void 0!==e.extendedDelegation&&e.extendedDelegation&&!settingsLoaded&&-1!=e.href.indexOf(globalLoginUsername)&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)){var g=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();""!=g?ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+g)):loadSettings(g,!0,!1):(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1))}if(void 0!==e.extendedDelegation&&e.extendedDelegation){var b=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response");$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-user-address-set").children().each(function(l,t){var a=$(t).text();-1!=a.indexOf("mailto:")&&(e.principalEmail=a.split("mailto:")[1])}),""==globalEmailAddress&&void 0!==e.principalEmail&&(globalEmailAddress=e.principalEmail);var p=b.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("addressbook-home-set").children().filterNsNode("href").text();""==p&&(p=b.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=p.match(RegExp("^https?://","i"))?e.abhref=p:e.abhref=n+p;var v=b.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-home-set").children().filterNsNode("href").text();""==v&&(v=b.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=v.match(RegExp("^https?://","i"))?e.cahref=v:e.cahref=n+v}l==t&&(isAvaible("CardDavMATE")&&runCardDAV(),isAvaible("CalDavZAP")&&runCalDAV(),isAvaible("Projects")&&runProjects(),isAvaible("Settings")&&runSettings(),globalResourceNumber=globalAccountSettings.length,loadAllResources())}void 0!==e.extendedDelegation&&e.extendedDelegation?(-1!=e.href.indexOf(globalLoginUsername)&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)&&(i='<D:property name="settings" namespace="http://inf-it.com/ns/dav/"/>'),d='<?xml version="1.0" encoding="utf-8"?><D:expand-property xmlns:D="DAV:"><D:property name="calendar-proxy-read-for" namespace="http://calendarserver.org/ns/"><D:property name="resourcetype"/><D:property name="current-user-privilege-set"/><D:property name="displayname"/><D:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="calendar-home-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="addressbook-home-set" namespace="urn:ietf:params:xml:ns:carddav"/></D:property><D:property name="calendar-proxy-write-for" namespace="http://calendarserver.org/ns/"><D:property name="resourcetype"/><D:property name="current-user-privilege-set"/><D:property name="displayname"/><D:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="calendar-home-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="addressbook-home-set" namespace="urn:ietf:params:xml:ns:carddav"/></D:property>'+i+'<D:property name="resourcetype"/><D:property name="current-user-privilege-set"/><D:property name="displayname"/><D:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="calendar-home-set" namespace="urn:ietf:params:xml:ns:caldav"/><D:property name="addressbook-home-set" namespace="urn:ietf:params:xml:ns:carddav"/></D:expand-property>'):d='<?xml version="1.0" encoding="utf-8"?><A:expand-property xmlns:A="DAV:"><A:property name="calendar-proxy-read-for" namespace="http://calendarserver.org/ns/"><A:property name="email-address-set" namespace="http://calendarserver.org/ns/"/><A:property name="displayname" namespace="DAV:"/><A:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/></A:property><A:property name="calendar-proxy-write-for" namespace="http://calendarserver.org/ns/"><A:property name="email-address-set" namespace="http://calendarserver.org/ns/"/><A:property name="displayname" namespace="DAV:"/><A:property name="calendar-user-address-set" namespace="urn:ietf:params:xml:ns:caldav"/></A:property></A:expand-property>';var u=e.href.match("^(.*/)([^/]+)/$");null!=globalXMLCache&&(a=globalXMLCache.children('davprincipaldelegation[request_url="'+jqueryEscapeSelector(u[1]+encodeURIComponent(u[2])+"/")+'"]').remove()).length?("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&-1!=globalDebug.indexOf("cache")&&console.log("DBG Cache OK: "+arguments.callee.name+" url: '"+e.href+"': saved one request!"),c(0,0,{responseXML:a})):("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&-1!=globalDebug.indexOf("cache")&&console.log("DBG Cache ERROR: "+arguments.callee.name+" url: '"+e.href+"': spend one request!"),$.ajax({type:"REPORT",url:e.href,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:d,dataType:"xml",error:function(e,l){console.log("Error: [DAVresourceDelegation: 'REPORT "+s+"'] code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" (this error code usually means network connection error, or your browser is trying to make a cross domain query, but it is not allowed by the destination server or the browser itself)":""))},success:c}))}function netFindResource(e,l,t,a,o){if(globalPreventLogoutSync)return logout(!0),!1;if(a<globalAccountSettings.length&&(globalResourceNumberCount++,(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible("CalDavZAP")&&globalCalDAVInitLoad||isAvaible("Projects")&&!isProjectsLoaded||isAvaible("Settings")&&!isSettingsLoaded)&&$("#MainLoaderInner").html(localization[globalInterfaceLanguage].loadingResources.replace("%act%",globalResourceNumberCount).replace("%total%",globalResourceNumber))),void 0!==e&&void 0!==e.collectionTypes&&null!=e.collectionTypes&&-1==e.collectionTypes.indexOf("calendar")&&-1==e.collectionTypes.indexOf("addressbook")||void 0!==e&&void 0!==o&&null!=o&&-1==o.indexOf(e.href))return a++,netFindResource(globalAccountSettings[a],l,t,a,o),!1;if(a>=globalAccountSettings.length&&settingsLoaded){null==globalResourceIntervalID&&(globalResourceIntervalID=setInterval(reloadResources,globalSettings.syncresourcesinterval.value)),globalCalDAVResourceSync=!1,globalCardDAVResourceSync=!1,globalSyncSettingsSave=!1;var r=new RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)"),n=new RegExp("^(https?://)(.*)","i"),s=new RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@([^/]+)(.*/)","i");if(isAvaible("CalDavZAP")&&!isCalDAVLoaded||isAvaible("CardDavMATE")&&!isCardDAVLoaded){if(isAvaible("CalDavZAP")){if(!globalDefaultCalendarCollectionActiveAll){for(var i=0;i<globalSettings.activecalendarcollections.value.length;i++)if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){var d=(p=globalSettings.activecalendarcollections.value[i].match("^(.*/)([^/]+)/([^/]+)/$"))[2]+"/"+p[3]+"/";if($('#ResourceCalDAVList input[data-id$="'+d+'"]:visible').length>0)(v=$('#ResourceCalDAVList input[data-id$="'+d+'"]')).trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,v.attr("data-id"))}else{var c=globalSettings.activecalendarcollections.value[i].match(n)[1],u=globalSettings.activecalendarcollections.value[i].match(n)[2];if(""!=globalLoginUsername)var g=globalLoginUsername;else g=globalAccountSettings[0].userAuth.userName;var b=c+g+"@"+u;$('#ResourceCalDAVList input[data-id="'+b+'"]:visible').length>0&&($('#ResourceCalDAVList input[data-id="'+b+'"]').trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,b))}globalSettings.activecalendarcollections.value.length>0&&0==globalVisibleCalDAVCollections.length&&(globalDefaultCalendarCollectionActiveAll=!0)}if(globalDefaultCalendarCollectionActiveAll)for(i=0;i<globalResourceCalDAVList.collections.length;i++)null!=globalResourceCalDAVList.collections[i].uid&&$('#ResourceCalDAVList input[data-id="'+globalResourceCalDAVList.collections[i].uid+'"]:visible').length>0&&($('#ResourceCalDAVList input[data-id="'+globalResourceCalDAVList.collections[i].uid+'"]').trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,globalResourceCalDAVList.collections[i].uid));if(!globalDefaultTodoCalendarCollectionActiveAll){for(i=0;i<globalSettings.activetodocollections.value.length;i++)if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){var p,v;d=(p=globalSettings.activetodocollections.value[i].match("^(.*/)([^/]+)/([^/]+)/$"))[2]+"/"+p[3]+"/";if($('#ResourceCalDAVTODOList input[data-id$="'+d+'"]:visible').length>0)(v=$('#ResourceCalDAVTODOList input[data-id$="'+d+'"]')).trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,v.attr("data-id"))}else{c=globalSettings.activetodocollections.value[i].match(n)[1],u=globalSettings.activetodocollections.value[i].match(n)[2];if(""!=globalLoginUsername)g=globalLoginUsername;else g=globalAccountSettings[0].userAuth.userName;b=c+g+"@"+u;$('#ResourceCalDAVTODOList input[data-id="'+b+'"]:visible').length>0&&($('#ResourceCalDAVTODOList input[data-id="'+b+'"]').trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,b))}globalSettings.activetodocollections.value.length>0&&0==globalVisibleCalDAVTODOCollections.length&&(globalDefaultTodoCalendarCollectionActiveAll=!0)}if(globalDefaultTodoCalendarCollectionActiveAll)for(i=0;i<globalResourceCalDAVList.TodoCollections.length;i++)null!=globalResourceCalDAVList.TodoCollections[i].uid&&$('#ResourceCalDAVTODOList input[data-id="'+globalResourceCalDAVList.TodoCollections[i].uid+'"]:visible').length>0&&($('#ResourceCalDAVTODOList input[data-id="'+globalResourceCalDAVList.TodoCollections[i].uid+'"]').trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,globalResourceCalDAVList.TodoCollections[i].uid));if(0==$("#ResourceCalDAVList .resourceCalDAV_item[data-id]:visible").length&&globalResourceCalDAVList.collections.length>1){for(var h=new Array,f=0;f<globalResourceCalDAVList.collections.length;f++)if(null!=globalResourceCalDAVList.collections[f].uid){var m=(V=globalResourceCalDAVList.collections[f].accountUID.match(s))[1]+V[3]+V[4];globalAccountSettings[0].href==m&&globalAccountSettings[0].userAuth.userName==globalResourceCalDAVList.collections[f].userAuth.userName&&h.push(globalResourceCalDAVList.collections[f])}0==h.length&&h.push(globalResourceCalDAVList.collections[1]);for(f=0;f<h.length;f++){h[f].makeLoaded=!0;var A=h[f].uid.match(r);globalSettings.loadedcalendarcollections.value.push(A[1]+A[3]),(D=(C=$("#ResourceCalDAVList").find('.resourceCalDAV_item[data-id="'+jqueryEscapeSelector(h[f].uid)+'"]')).prevUntil(".resourceCalDAV_header").last().prev()).length||(D=C.prev()),D.css("display","block"),C.css("display",""),C.find("input[type=checkbox]").not(".unloadCheck").trigger("click"),globalVisibleCalDAVCollections.splice(globalVisibleCalDAVCollections.length,0,h[f].uid)}}if(0==$("#ResourceCalDAVTODOList .resourceCalDAVTODO_item[data-id]:visible").length&&globalResourceCalDAVList.TodoCollections.length>1){for(h=new Array,f=0;f<globalResourceCalDAVList.TodoCollections.length;f++)if(null!=globalResourceCalDAVList.TodoCollections[f].uid){m=(V=globalResourceCalDAVList.TodoCollections[f].accountUID.match(s))[1]+V[3]+V[4];globalAccountSettings[0].href==m&&globalAccountSettings[0].userAuth.userName==globalResourceCalDAVList.TodoCollections[f].userAuth.userName&&h.push(globalResourceCalDAVList.TodoCollections[f])}0==h.length&&h.push(globalResourceCalDAVList.TodoCollections[1]);for(f=0;f<h.length;f++){$('#ResourceCalDAVTODOList .resourceCalDAVTODO_item[data-id="'+h[f].uid+'"]').css("display","block"),h[f].makeLoaded=!0;var C,D;A=h[f].uid.match(r);globalSettings.loadedtodocollections.value.push(A[1]+A[3]),(D=(C=$("#ResourceCalDAVTODOList").find('.resourceCalDAVTODO_item[data-id="'+jqueryEscapeSelector(h[f].uid)+'"]')).prevUntil(".resourceCalDAVTODO_header").last().prev()).length||(D=C.prev()),D.css("display","block"),C.css("display",""),C.find("input[type=checkbox]").not(".unloadCheck").trigger("click"),globalVisibleCalDAVTODOCollections.splice(globalVisibleCalDAVTODOCollections.length,0,h[f].uid)}}$("#ResourceCalDAVList").children(".resourceCalDAV_header").each(function(){$(this).nextUntil(".resourceCalDAV_header").filter(":visible").length||$(this).css("display","none")}),$("#ResourceCalDAVTODOList").children(".resourceCalDAVTODO_header").each(function(){$(this).nextUntil(".resourceCalDAVTODO_header").filter(":visible").length||$(this).css("display","none")}),selectActiveCalendar()}if(isAvaible("CardDavMATE")){if(0==$("#ResourceCardDAVList .resourceCardDAV_item:visible").length&&globalResourceCardDAVList.collections.length>1){for(h=new Array,f=0;f<globalResourceCardDAVList.collections.length;f++)if(null!=globalResourceCardDAVList.collections[f].uid){m=(V=globalResourceCardDAVList.collections[f].accountUID.match(s))[1]+V[3]+V[4];globalAccountSettings[0].href==m&&globalAccountSettings[0].userAuth.userName==globalResourceCardDAVList.collections[f].userAuth.userName&&h.push(globalResourceCardDAVList.collections[f])}0==h.length&&h.push(globalResourceCardDAVList.collections[1]);for(f=0;f<h.length;f++){$('#ResourceCardDAVList .resourceCardDAV_item .resourceCardDAV[data-id="'+h[f].uid+'"]').parent().css("display","block"),h[f].makeLoaded=!0;A=h[f].uid.match(r);globalSettings.loadedaddressbookcollections.value.push(A[1]+A[3]),globalSettings.activeaddressbookcollections.value.push(A[1]+A[3])}}$("#ResourceCardDAVList").children(".resourceCardDAV_header").each(function(){$(this).nextUntil(".resourceCardDAV_header").filter(":visible").length||$(this).css("display","none")})}loadNextApplication(!0)}var y=!1,L=!1;if(isAvaible("CalDavZAP")){var S;setCalendarNumber(!1),selectActiveCalendar(),0==(S=globalResourceCalDAVList.TodoCollections).length||1==S.length&&void 0===S[0].uid?($("#intCaldavTodo").css("display","none"),y=!1):($("#intCaldavTodo").css("display","block"),y=!0);var N=new Array;for(i=0;i<S.length;i++)null!=S[i].uid&&(N[N.length]={displayValue:S[i].displayvalue,uid:S[i].uid,permissions_read_only:S[i].permissions.read_only,makeLoaded:S[i].makeLoaded});N.sort(customResourceCompare),globalResourceCalDAVList.sortedTodoCollections=N,0==(S=globalResourceCalDAVList.collections).length||1==S.length&&void 0===S[0].uid?($("#intCaldav").css("display","none"),L=!1):($("#intCaldav").css("display","block"),L=!0),N=new Array;for(i=0;i<S.length;i++)null!=S[i].uid&&(N[N.length]={displayValue:S[i].displayvalue,uid:S[i].uid,permissions_read_only:S[i].permissions.read_only,makeLoaded:S[i].makeLoaded});N.sort(customResourceCompare),globalResourceCalDAVList.sortedCollections=N}var T=!1;if(isAvaible("CardDavMATE")){for(var R in selectActiveAddressbook(),globalAddressbookList.vcard_groups)globalAddressbookList.vcard_groups[R].length>0&&(extendDestSelect(),void 0===$("#vCardEditor").attr("data-vcard-uid")&&$("#vCardEditor").find('[data-attr-name="_DEST_"]').find('optiotn[data-type$="'+$("#ResourceCardDAVList").find(".resourceCardDAV_selected").find(":input[data-id]").attr("data-id")+'"]').prop("selected",!0));var x=globalResourceCardDAVList.collections;0==x.length||1==x.length&&void 0===x[0].uid?($("#intCarddav").css("display","none"),T=!1):(T=!0,$("#intCarddav").css("display","block"))}return(isAvaible("CalDavZAP")&&!isCalDAVLoaded||isAvaible("CardDavMATE")&&!isCardDAVLoaded)&&(isAvaible("CalDavZAP")&&("CalDavTODO"==globalActiveApp&&(y||(globalActiveApp=null)),null!=globalActiveApp&&"CalDavZAP"!=globalActiveApp||(globalActiveApp=L?"CalDavZAP":null)),!isAvaible("CardDavMATE")||null!=globalActiveApp&&"CardDavMATE"!=globalActiveApp||(globalActiveApp=T?"CardDavMATE":null),null!=globalActiveApp&&checkForApplication(globalActiveApp)),ifLoadCollections(),isAvaible("CalDavZAP")&&(0==$("#ResourceCalDAVList .resourceCalDAV_item:visible").not(".resourceCalDAV_item_ro").length?($("#eventFormShower").css("display","none"),$("#calendar").fullCalendar("setOptions",{selectable:!1})):($("#eventFormShower").css("display","block"),$("#calendar").fullCalendar("setOptions",{selectable:!0})),0==$("#ResourceCalDAVTODOList .resourceCalDAVTODO_item:visible").not(".resourceCalDAV_item_ro").length?$("#eventFormShowerTODO").css("display","none"):$("#eventFormShowerTODO").css("display","block")),!1}if(a>=globalAccountSettings.length&&!settingsLoaded)return console.log("Error: [netFindResource]: 'Unable to load resources'"),!1;var V,O=new RegExp("^(https?://)([^/]+)(.*)","i"),w=((V=e.href.match(O))[1],e.userAuth.userName,V[2],V[1]+e.userAuth.userName+"@"+V[2]+V[3]),E="";-1!=e.href.indexOf(globalLoginUsername)&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value)&&(E='<I:settings xmlns:I="http://inf-it.com/ns/dav/"/>');var _=V[1]+V[2];if(void 0!==e.extendedDelegation&&e.extendedDelegation&&(void 0!==e.abhref||void 0!==e.cahref))return isAvaible("CardDavMATE")&&isAvaible("CalDavZAP")?e.abhref==e.cahref?netLoadResource(e,e.abhref,!1,l,t,a,o):netLoadResource(e,e.abhref,!0,l,t,a,o):isAvaible("CardDavMATE")?netLoadResource(e,e.abhref,!1,l,t,a,o):isAvaible("CalDavZAP")&&netLoadResource(e,e.cahref,!1,l,t,a,o),!1;$.ajax({type:"PROPFIND",url:e.href,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(r){if(1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&r.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),r.setRequestHeader("X-client",globalXClientHeader),r.setRequestHeader("Depth","0"),(""!=globalSettingsSaving||isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&!globalCardDAVResourceSync||isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&!globalCalDAVResourceSync||isAvaible("Projects")&&isProjectsLoaded)&&(""!=globalSettingsSaving||isAvaible("Settings")&&"visible"==$("#SystemSettings").css("visibility")&&"setting_group_password"==$(".resourceSettings_item_selected").attr("data-type")))return a++,(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible("CalDavZAP")&&globalCalDAVInitLoad)&&a==globalAccountSettings.length&&$("#MainLoader").fadeOut(1200),netFindResource(globalAccountSettings[a],l,t,a,o),!1},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop>'+E+'<D:current-user-privilege-set/><D:displayname/><D:resourcetype/><L:calendar-home-set xmlns:L="urn:ietf:params:xml:ns:caldav"/><R:addressbook-home-set xmlns:R="urn:ietf:params:xml:ns:carddav"/></D:prop></D:propfind>',dataType:"xml",error:function(r,n){console.log("Error: [netFindResource: 'PROPFIND "+w+"']: code: '"+r.status+"' status: '"+n+"'"+(0==r.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),a++,e.errorLoaded=!0,isAvaible("CalDavZAP")&&($("#intCaldav").find(".int_error").css("display","block"),$("#intCaldavTodo").find(".int_error").css("display","block")),isAvaible("CardDavMATE")&&$("#intCarddav").find(".int_error").css("display","block");for(var s=!0,i=0;i<globalAccountSettings.length;i++)void 0!==globalAccountSettings[i].errorLoaded&&null!=globalAccountSettings[i].errorLoaded&&!1!==globalAccountSettings[i].errorLoaded||(s=!1);return(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible(globalCalDAVInitLoad))&&a==globalAccountSettings.length&&s?$("#MainLoader").fadeOut(1200):(isAvaible("CardDavMATE")&&!globalCardDAVInitLoad||isAvaible("CalDavZAP")&&!globalCalDAVInitLoad)&&(isAvaible("CalDavZAP")&&handleCalDAVError(!0,e),isAvaible("CardDavMATE")&&handleCardDAVError(!0,e)),netFindResource(globalAccountSettings[a],l,t,a,o),!1},success:function(r,n,s){if(e.errorLoaded=!1,isAvaible("CalDavZAP")&&isEachResourceLoaded()&&($("#intCaldav").find(".int_error").css("display","none"),$("#intCaldavTodo").find(".int_error").css("display","none")),isAvaible("CardDavMATE")&&isEachResourceLoaded()&&$("#intCarddav").find(".int_error").css("display","none"),isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&handleCalDAVError(!1,e),isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&handleCardDAVError(!1,e),!settingsLoaded&&-1!=e.href.indexOf(globalLoginUsername)&&e.settingsAccount&&(""==globalSettings.settingstype.value||null==globalSettings.settingstype.value||""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&"principal-URL"==globalSettings.settingstype.value))""!=(u=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text())?ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+u)):loadSettings(u,!0,!1):(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1));else if(!globalSyncSettingsSave&&-1!=e.href.indexOf(globalLoginUsername)&&(isAvaible("CardDavMATE")&&globalCardDAVResourceSync||isAvaible("CalDavZAP")&&globalCalDAVResourceSync)){globalSyncSettingsSave=!0;var i=new Array,d=new Array,c=new Array;isAvaible("CardDavMATE")&&(c=globalSettings.loadedaddressbookcollections.value.slice()),isAvaible("CalDavZAP")&&(i=globalSettings.loadedcalendarcollections.value.slice(),d=globalSettings.loadedtodocollections.value.slice());var u=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();"undefined"!=typeof globalPreviousSupportedSettings&&null!=globalPreviousSupportedSettings&&loadSettings(u,!0,!0),isAvaible("CardDavMATE")&&(globalSettings.loadedaddressbookcollections.value=c.slice()),isAvaible("CalDavZAP")&&(globalSettings.loadedcalendarcollections.value=i.slice(),globalSettings.loadedtodocollections.value=d.slice()),checkBeforeClose(!1)}var g=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response"),b=g.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("addressbook-home-set").children().filterNsNode("href").text();""==b&&(b=g.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=b.match(RegExp("^https?://","i"))?e.abhref=b:e.abhref=_+b;var p=g.children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-home-set").children().filterNsNode("href").text();""==p&&(p=g.children().filterNsNode("href").text().replace("/principals/users/caldav.php","/caldav.php")),null!=p.match(RegExp("^https?://","i"))?e.cahref=p:e.cahref=_+p,isAvaible("CardDavMATE")&&isAvaible("CalDavZAP")?e.abhref==e.cahref?netLoadResource(e,e.abhref,!1,l,t,a,o):netLoadResource(e,e.abhref,!0,l,t,a,o):isAvaible("CardDavMATE")?netLoadResource(e,e.abhref,!1,l,t,a,o):isAvaible("CalDavZAP")&&netLoadResource(e,e.cahref,!1,l,t,a,o)}})}function netLoadResource(e,l,t,a,o,r,n){var s=new RegExp("^(https?://)([^/]+)(.*)","i");(!isAvaible("CardDavMATE")||!globalCardDAVInitLoad||globalCardDAVInitLoad&&void 0===e.addressbookNo)&&(e.addressbookNo=0),(!isAvaible("CalDavZAP")||!globalCalDAVInitLoad||globalCalDAVInitLoad&&void 0===e.calendarNo&&void 0===e.todoNo)&&(e.calendarNo=0,e.todoNo=0);var i,d=(i=e.abhref.match(s))[1]+i[2],c=i[1]+e.userAuth.userName+"@"+i[2],u=i[1]+e.userAuth.userName+"@"+i[2]+i[3],g=(i=e.href.match(RegExp("^(https?://)(.*)","i")))[1]+e.userAuth.userName+"@"+i[2];if("undefined"!=typeof globalSubscribedCalendars&&null!=globalSubscribedCalendars&&void 0!==e.calendars&&null!=e.calendars&&e.calendars.length>0){for(var b=e.href.match(RegExp("^(https?://)(.*)","i")),p=b[1]+e.userAuth.userName+"@"+b[2],v=(new Date).getTime(),h=0;h<globalSubscribedCalendars.calendars.length;h++){if(color=globalSubscribedCalendars.calendars[h].color,""==color){for(var f=(c+globalSubscribedCalendars.calendars[h].href).split("/"),m=hex_sha256(hex_sha256(f[f.length-3]+"/"+f[f.length-2]+"/")),A=m.substring(0,6);checkColorBrightness(A)>=252;)A=hex_sha256(hex_sha256(m)).substring(0,6);color="#"+A}var C=!0;(c+"/"+globalSubscribedCalendars.calendars[h].href+"/").split("/");if(-1!=globalSubscribedCalendars.calendars[h].typeList.indexOf("vevent")){var D=(x=(c+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")))[1]+x[3];if(isHrefSet||(saveHref=c+href,isHrefSet=!0),globalDefaultCalendarCollectionLoadAll){globalCalDAVInitLoad&&globalSettings.loadedcalendarcollections.value.push(D);y=!0}else{var y=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(var L=(x=(c+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("/([^/]+/[^/]+/)$")))[1].match("^(.*/)([^/]+)/$"),S=decodeURIComponent(L[1])+L[2]+"/",N=!1,T=0;T<globalSettings.loadedcalendarcollections.value.length;T++){var R=globalSettings.loadedcalendarcollections.value[T].match("^(.*/)([^/]+)/([^/]+)/$");if(S==decodeURIComponent(R[2])+"/"+R[3]+"/"){N=!0,globalSettings.loadedcalendarcollections.value[T]=D;break}}y=N}else y=-1!=globalSettings.loadedcalendarcollections.value.indexOf(D)}globalResourceCalDAVList.insertResource({makeLoaded:y,typeList:globalSubscribedCalendars.calendars[h].typeList,listType:"vevent",syncRequired:C,ecolor:color,timestamp:v,uid:c+"/"+globalSubscribedCalendars.calendars[h].href+"/",timeOut:e.timeOut,displayvalue:globalSubscribedCalendars.calendars[h].displayName,userAuth:globalSubscribedCalendars.calendars[h].userAuth,resourceIndex:r,url:d,accountUID:p,href:globalSubscribedCalendars.calendars[h].href,hrefLabel:globalSubscribedCalendars.hrefLabel,permissions:{full:[],read_only:!0},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!0,newlyAdded:y,urlArray:new Array,ignoreAlarms:globalSubscribedCalendars.calendars[h].ignoreAlarm,webdav_bind:!1},r,!0),null!=e&&e.calendarNo++,C=!1}if(-1!=globalSubscribedCalendars.calendars[h].typeList.indexOf("vtodo")){D=(x=(c+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")))[1]+x[3];if(isHrefSet||(saveHref=c+href,isHrefSet=!0),globalDefaultTodoCalendarCollectionLoadAll){y=!0;globalCalDAVInitLoad&&globalSettings.loadedtodocollections.value.push(D)}else{var y=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&globalCrossServerSettingsURL){var x;for(L=(x=(c+"/"+globalSubscribedCalendars.calendars[h].href+"/").match(RegExp("/([^/]+/[^/]+/)$")))[1].match("^(.*/)([^/]+)/$"),S=decodeURIComponent(L[1])+L[2]+"/",N=!1,T=0;T<globalSettings.loadedtodocollections.value.length;T++){R=globalSettings.loadedtodocollections.value[T].match("^(.*/)([^/]+)/([^/]+)/$");if(S==decodeURIComponent(R[2])+"/"+R[3]+"/"){N=!0,globalSettings.loadedtodocollections.value[T]=D;break}}y=N}else y=-1!=globalSettings.loadedtodocollections.value.indexOf(D)}globalResourceCalDAVList.insertResource({makeLoaded:y,typeList:globalSubscribedCalendars.calendars[h].typeList,listType:"vtodo",syncRequired:C,ecolor:color,timestamp:v,uid:c+"/"+globalSubscribedCalendars.calendars[h].href+"/",timeOut:e.timeOut,displayvalue:globalSubscribedCalendars.calendars[h].displayName,userAuth:globalSubscribedCalendars.calendars[h].userAuth,resourceIndex:r,url:d,accountUID:p,href:globalSubscribedCalendars.calendars[h].href,hrefLabel:globalSubscribedCalendars.hrefLabel,permissions:{full:[],read_only:!0},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!0,newlyAdded:y,urlArray:new Array,ignoreAlarms:globalSubscribedCalendars.calendars[h].ignoreAlarm,webdav_bind:!1},r,!1),null!=e&&e.todoNo++}}return r++,netFindResource(globalAccountSettings[r],a,o,r,n),!0}var V,O="";function w(s,i,u){e.errorLoaded=!1,isAvaible("CalDavZAP")&&isEachResourceLoaded()&&($("#intCaldav").find(".int_error").css("display","none"),$("#intCaldavTodo").find(".int_error").css("display","none")),isAvaible("CardDavMATE")&&isEachResourceLoaded()&&$("#intCarddav").find(".int_error").css("display","none"),isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&handleCalDAVError(!1,e),isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&handleCardDAVError(!1,e);var b="";isHrefSet=!1;var p=(new Date).getTime();if(!settingsLoaded&&-1!=e.href.indexOf(globalLoginUsername)&&e.settingsAccount&&""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value){if("addressbook-home-set"==globalSettings.settingstype.value&&e.abhref==l||"calendar-home-set"==globalSettings.settingstype.value&&e.cahref==l)if(""!=(A=$(u.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text()))ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+A)):loadSettings(A,!0,!1);else{var v=$(u.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("cal-settings").text();""!=v?ignoreServerSettings?(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1),console.log("Ignoring server settings: \n"+v)):loadSettings(v,!0,!1):(delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1))}}else if(settingsLoaded||-1==e.href.indexOf(globalLoginUsername)){if(!globalSyncSettingsSave&&-1!=e.href.indexOf(globalLoginUsername)&&(isAvaible("CardDavMATE")&&globalCardDAVResourceSync||isAvaible("CalDavZAP")&&globalCalDAVResourceSync)){globalSyncSettingsSave=!0;var h=new Array,f=new Array,m=new Array;isAvaible("CardDavMATE")&&(m=globalSettings.loadedaddressbookcollections.value.slice()),isAvaible("CalDavZAP")&&(h=globalSettings.loadedcalendarcollections.value.slice(),f=globalSettings.loadedtodocollections.value.slice());var A=$(u.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("settings").text();"undefined"!=typeof globalPreviousSupportedSettings&&null!=globalPreviousSupportedSettings&&loadSettings(A,!0,!0),isAvaible("CardDavMATE")&&(globalSettings.loadedaddressbookcollections.value=m.slice()),isAvaible("CalDavZAP")&&(globalSettings.loadedcalendarcollections.value=h.slice(),globalSettings.loadedtodocollections.value=f.slice()),checkBeforeClose(!1)}}else delete globalSettings.version.value,loadSettings(JSON.stringify(globalSettings),!1,!1);if($(u.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").each(function(l,t){$(t).children().filterNsNode("propstat").each(function(l,o){var n=$(o).children().filterNsNode("prop"),s="",i=new Array;if(n.children().filterNsNode("supported-calendar-component-set").children().filterNsNode("comp").each(function(e,l){i[i.length]=l.getAttribute("name").toLowerCase()}),(void 0!==e&&void 0!==e.collectionTypes&&null!=e.collectionTypes&&-1!=e.collectionTypes.indexOf("calendar")||void 0===e||null==e.collectionTypes)&&isAvaible("CalDavZAP")&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("calendar").length&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("collection").length&&(null==e.ignoreBound||1!=e.ignoreBound||1!=n.children().filterNsNode("resourcetype").children().filterNsNode("webdav-binding").length)){1==n.children().filterNsNode("calendar-color").length&&9==(s=n.children().filterNsNode("calendar-color").text()).length&&(s=s.substring(0,7));var u=new Array;n.children().filterNsNode("current-user-privilege-set").children().filterNsNode("privilege").each(function(e,l){$(l).children().each(function(e,l){u[u.length]=$(l).prop("tagName").replace(/^[^:]+:/,"")})});var v=!1;if(null!=(M=$(t).children().filterNsNode("href").text()).match(RegExp("^https?://","i")))null!=(H=M.match(RegExp("^(https?://)([^/]+)(.*)","i")))&&(M=H[3]);if(u.length>0&&-1==u.indexOf("all")&&-1==u.indexOf("write")&&-1==u.indexOf("write-content"))v=!0;else if(null!=e.forceReadOnly&&(1==e.forceReadOnly||e.forceReadOnly instanceof Array))if(e.forceReadOnly instanceof Array)for(var h=0;h<e.forceReadOnly.length;h++)if("string"==typeof e.forceReadOnly[h]){-1!=(N=M.indexOf(e.forceReadOnly[h]))&&M.length==N+e.forceReadOnly[h].length&&(v=!0)}else"object"==typeof e.forceReadOnly[h]&&null!=M.match(e.forceReadOnly[h])&&(v=!0);else v=!0;var f=n.children().filterNsNode("displayname").text(),m=n.children().filterNsNode("headervalue").text(),A=n.children().filterNsNode("sync-token").text(),C="",D=M.match(RegExp(".*/([^/]+)/$","i"));if(""==f&&(f=D[1]),""==s){for(var y=(c+M).split("/"),L=(X=hex_sha256(hex_sha256(y[y.length-3]+"/"+y[y.length-2]+"/"))).substring(0,6);checkColorBrightness(L)>=252;)L=hex_sha256(hex_sha256(X)).substring(0,6);s="#"+L}var S=!1;(c+M).split("/");if("boolean"==typeof e.ignoreAlarms&&e.ignoreAlarms)S=!0;else if(e.ignoreAlarms instanceof Array&&e.ignoreAlarms.length>0)for(h=0;h<e.ignoreAlarms.length;h++){var N;if("string"==typeof e.ignoreAlarms[h])-1!=(N=M.indexOf(e.ignoreAlarms[h]))&&M.length==N+e.ignoreAlarms[h].length&&(S=!0);else"object"==typeof e.ignoreAlarms[h]&&null!=M.match(e.ignoreAlarms[h])&&(S=!0)}var T=!1;1==n.children().filterNsNode("resourcetype").children().filterNsNode("webdav-binding").length&&(T=!0);var R=null==e.checkContentType||e.checkContentType,x=!0;if(-1!=i.indexOf("vevent")){var V=!1;null!=(U=globalResourceCalDAVList.getEventCollectionByUID(c+M))?U.syncToken!=A&&(V=!0):(V=!0,""==A&&(A=null));var O=(z=(c+M).match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")))[1]+z[3];if(isHrefSet||(b=c+M,isHrefSet=!0),globalDefaultCalendarCollectionLoadAll){w=!0;globalCalDAVInitLoad&&globalSettings.loadedcalendarcollections.value.push(O)}else{var w=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(var E=(z=(c+M).match(RegExp("/([^/]+/[^/]+/)$")))[1].match("^(.*/)([^/]+)/$"),_=decodeURIComponent(E[1])+E[2]+"/",I=!1,k=0;k<globalSettings.loadedcalendarcollections.value.length;k++){var P=globalSettings.loadedcalendarcollections.value[k].match("^(.*/)([^/]+)/([^/]+)/$");if(_==decodeURIComponent(P[2])+"/"+P[3]+"/"){I=!0,globalSettings.loadedcalendarcollections.value[k]=O;break}}w=I}else w=-1!=globalSettings.loadedcalendarcollections.value.indexOf(O)}w||(C=""),globalResourceCalDAVList.insertResource({makeLoaded:w,typeList:i,listType:"vevent",ecolor:s,timestamp:p,uid:c+M,timeOut:e.timeOut,displayvalue:f,headervalue:m,userAuth:e.userAuth,resourceIndex:r,url:d,accountUID:g,href:M,hrefLabel:e.hrefLabel,permissions:{full:u,read_only:v},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!1,newlyAdded:w,urlArray:null,ignoreAlarms:S,webdav_bind:T,syncRequired:x,checkContentType:R,syncToken:A,oldSyncToken:C,someChanged:V},r,!0),null!=globalAccountSettings[r]&&globalAccountSettings[r].calendarNo++,x=!1}if(-1!=i.indexOf("vtodo")){V=!1;var U=globalResourceCalDAVList.getTodoCollectionByUID(c+M);x&&null!=U?U.syncToken!=A&&(V=!0):(V=!0,""==A&&(A=null));O=(z=(c+M).match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")))[1]+z[3];if(isHrefSet||(b=c+M,isHrefSet=!0),globalDefaultTodoCalendarCollectionLoadAll){w=!0;globalCalDAVInitLoad&&globalSettings.loadedtodocollections.value.push(O)}else{var w=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){for(E=(z=(c+M).match(RegExp("/([^/]+/[^/]+/)$")))[1].match("^(.*/)([^/]+)/$"),_=decodeURIComponent(E[1])+E[2]+"/",I=!1,k=0;k<globalSettings.loadedtodocollections.value.length;k++){P=globalSettings.loadedtodocollections.value[k].match("^(.*/)([^/]+)/([^/]+)/$");if(_==decodeURIComponent(P[2])+"/"+P[3]+"/"){I=!0,globalSettings.loadedtodocollections.value[k]=O;break}}w=I}else w=-1!=globalSettings.loadedtodocollections.value.indexOf(O)}w||(C=""),globalResourceCalDAVList.insertResource({makeLoaded:w,typeList:i,hrefArray:new Array,listType:"vtodo",ecolor:s,timestamp:p,uid:c+M,timeOut:e.timeOut,displayvalue:f,headervalue:m,userAuth:e.userAuth,resourceIndex:r,url:d,accountUID:g,href:M,hrefLabel:e.hrefLabel,permissions:{full:u,read_only:v},crossDomain:e.crossDomain,withCredentials:e.withCredentials,interval:null,waitInterval:null,displayEventsArray:new Array,pastUnloaded:"",fcSource:null,subscription:!1,newlyAdded:w,urlArray:null,ignoreAlarms:S,webdav_bind:T,syncRequired:x,checkContentType:R,syncToken:A,oldSyncToken:C,someChanged:V},r,!1),null!=globalAccountSettings[r]&&globalAccountSettings[r].todoNo++}}if((void 0!==e&&void 0!==e.collectionTypes&&null!=e.collectionTypes&&-1!=e.collectionTypes.indexOf("addressbook")||void 0===e||null==e.collectionTypes)&&isAvaible("CardDavMATE")&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("addressbook").length&&1==n.children().filterNsNode("resourcetype").children().filterNsNode("collection").length&&(null==e.ignoreBound||1!=e.ignoreBound||1!=n.children().filterNsNode("resourcetype").children().filterNsNode("webdav-binding").length)){1==n.children().filterNsNode("addressbook-color").length&&9==(s=n.children().filterNsNode("addressbook-color").text()).length&&(s=s.substring(0,7));u=new Array;n.children().filterNsNode("current-user-privilege-set").children().filterNsNode("privilege").each(function(e,l){$(l).children().each(function(e,l){u[u.length]=$(l).prop("tagName").replace(/^[^:]+:/,"")})});var M,H,q=!1,F=n.children().filterNsNode("supportedlock").children().filterNsNode("lockentry").children().filterNsNode("lockscope").children().filterNsNode("exclusive");if(void 0!==F&&null!=F.length&&0!=F.length||(q=!0),null!=(M=$(t).children().filterNsNode("href").text()).match(RegExp("^https?://","i")))null!=(H=M.match(RegExp("^(https?://)([^/]+)(.*)","i")))&&(M=H[3]);var j=M.match(RegExp("/([^/]+)/?$"));v=!1;(("undefined"==typeof globalDisablePermissionChecking||1!=globalDisablePermissionChecking)&&u.length>0&&-1==u.indexOf("all")&&-1==u.indexOf("write")&&-1==u.indexOf("write-content")||null!=e.forceReadOnly&&(1==e.forceReadOnly||e.forceReadOnly instanceof Array&&-1!=e.forceReadOnly.indexOf(j[1])))&&(v=!0);f=n.children().filterNsNode("displayname").text(),m=n.children().filterNsNode("headervalue").text(),A=n.children().filterNsNode("sync-token").text(),C="",D=M.match(RegExp(".*/([^/]+)/$","i"));if(""==f&&(f=D[1]),""==s){var X;for(y=(c+M).split("/"),L=(X=hex_sha256(hex_sha256(y[y.length-3]+"/"+y[y.length-2]+"/"))).substring(0,6);checkColorBrightness(L)>=252;)L=hex_sha256(hex_sha256(X)).substring(0,6);s="#"+L}R=null==e.checkContentType||e.checkContentType,V=!1;null!=(U=globalResourceCardDAVList.getCollectionByUID(c+M))?(U.syncToken!=A&&(V=!0),"undefined"!=typeof globalForceSyncURLArray&&globalForceSyncURLArray.length>0&&-1!=globalForceSyncURLArray.indexOf(U.uid)&&(V=!0)):(V=!0,""==A&&(A=null));O=(z=(c+M).match(RegExp("^(https?://)([^@/]+(?:@[^@/]+)?)@(.*)")))[1]+z[3];if(isHrefSet||(b=c+M,isHrefSet=!0),globalDefaultAddrCollectionLoadAll){w=!0;globalCardDAVInitLoad&&globalSettings.loadedaddressbookcollections.value.push(O)}else{w=!1;if("undefined"!=typeof globalCrossServerSettingsURL&&null!=globalCrossServerSettingsURL&&globalCrossServerSettingsURL){var z;for(E=(z=(c+M).match(RegExp("/([^/]+/[^/]+/)$")))[1].match("^(.*/)([^/]+)/$"),_=decodeURIComponent(E[1])+E[2]+"/",I=!1,k=0;k<globalSettings.loadedaddressbookcollections.value.length;k++){P=globalSettings.loadedaddressbookcollections.value[k].match("^(.*/)([^/]+)/([^/]+)/$");if(_==decodeURIComponent(P[2])+"/"+P[3]+"/"){I=!0,globalSettings.loadedaddressbookcollections.value[k]=O;break}}w=I}else w=-1!=globalSettings.loadedaddressbookcollections.value.indexOf(O)}globalResourceCardDAVList.insertResource({makeLoaded:w,timestamp:p,uid:c+M,timeOut:e.timeOut,displayvalue:f,headervalue:m,userAuth:e.userAuth,url:d,accountUID:g,href:M,hrefLabel:e.hrefLabel,color:s,permissions:{full:u,read_only:v},crossDomain:e.crossDomain,withCredentials:e.withCredentials,checkContentType:R,isLoaded:!1,newlyAdded:w,indexResource:r,disableLocking:q,syncToken:A,oldSyncToken:C,someChanged:V},a),e.addressbookNo++}})}),""!=b){var C=b.replace(new RegExp("[^/]+/$"),"");"undefined"!=typeof globalResourceCalDAVList&&null!=globalResourceCalDAVList&&globalResourceCalDAVList.removeOldResources(C,p),"undefined"!=typeof globalResourceCardDAVList&&null!=globalResourceCardDAVList&&globalResourceCardDAVList.removeOldResources(C,p)}t?netLoadResource(e,e.cahref,!1,a,o,r,n):(r++,netFindResource(globalAccountSettings[r],a,o,r,n))}-1!=e.href.indexOf(globalLoginUsername)&&e.settingsAccount&&""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&("addressbook-home-set"==globalSettings.settingstype.value&&e.abhref==l||"calendar-home-set"==globalSettings.settingstype.value&&e.cahref==l||"principal-URL"==globalSettings.settingstype.value&&(isAvaible("CardDavMATE")&&globalCardDAVResourceSync||isAvaible("CalDavZAP")&&globalCalDAVResourceSync))&&(O='<I:settings xmlns:I="http://inf-it.com/ns/dav/"/>'),null!=globalXMLCache&&(V=globalXMLCache.children('davprincipalcollections[request_url="'+jqueryEscapeSelector(l)+'"]').remove()).length?("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&-1!=globalDebug.indexOf("cache")&&console.log("DBG Cache OK: "+arguments.callee.name+" url: '"+l+"': saved one request!"),w(0,0,{responseXML:V})):("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&-1!=globalDebug.indexOf("cache")&&console.log("DBG Cache ERROR: "+arguments.callee.name+" url: '"+l+"': spend one request!"),$.ajax({type:"PROPFIND",url:l,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){if(1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","1"),(""!=globalSettingsSaving||isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&!globalCardDAVResourceSync||isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&!globalCalDAVResourceSync||isAvaible("Projects")&&isProjectsLoaded)&&(""!=globalSettingsSaving||isAvaible("Settings")&&"visible"==$("#SystemSettings").css("visibility")&&"setting_group_password"==$(".resourceSettings_item_selected").attr("data-type")))return r++,(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible(globalCalDAVInitLoad))&&r==globalAccountSettings.length&&$("#MainLoader").fadeOut(1200),netFindResource(globalAccountSettings[r],a,o,r,n),!1},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop>'+O+'<D:current-user-privilege-set/><D:displayname/><D:supportedlock/><D:resourcetype/><D:supported-report-set/><D:sync-token/><A:calendar-color xmlns:A="'+("undefined"!=typeof globalCalendarColorPropertyXmlns&&null!=globalCalendarColorPropertyXmlns&&""!=globalCalendarColorPropertyXmlns?globalCalendarColorPropertyXmlns:"http://apple.com/ns/ical/")+'"/><I:headervalue xmlns:I="http://inf-it.com/ns/dav/"/><I:addressbook-color xmlns:I="'+("undefined"!=typeof globalAddrColorPropertyXmlns&&null!=globalAddrColorPropertyXmlns&&""!=globalAddrColorPropertyXmlns?globalAddrColorPropertyXmlns:"http://inf-it.com/ns/ab/")+'"/><L:supported-calendar-component-set xmlns:L="urn:ietf:params:xml:ns:caldav"/><R:max-image-size xmlns:R="urn:ietf:params:xml:ns:carddav"/></D:prop></D:propfind>',dataType:"xml",error:function(l,s){if(console.log("Error: [netLoadResource: 'PROPFIND "+u+"']: code: '"+l.status+"' status: '"+s+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.errorLoaded=!0,isAvaible("CalDavZAP")&&($("#intCaldav").find(".int_error").css("display","block"),$("#intCaldavTodo").find(".int_error").css("display","block")),isAvaible("CardDavMATE")&&$("#intCarddav").find(".int_error").css("display","block"),t)netLoadResource(e,e.cahref,!1,a,o,r,n);else{r++;for(var i=!0,d=0;d<globalAccountSettings.length;d++)void 0!==globalAccountSettings[d].errorLoaded&&null!=globalAccountSettings[d].errorLoaded&&!1!==globalAccountSettings[d].errorLoaded||(i=!1);(isAvaible("CardDavMATE")&&globalCardDAVInitLoad||isAvaible("CalDavZAP")&&globalCalDAVInitLoad)&&r==globalAccountSettings.length&&i&&$("#MainLoader").fadeOut(1200),isAvaible("CalDavZAP")&&!globalCalDAVInitLoad&&handleCalDAVError(!0,e),isAvaible("CardDavMATE")&&!globalCardDAVInitLoad&&handleCardDAVError(!0,e),netFindResource(globalAccountSettings[r],a,o,r,n)}return!1},success:w}))}function netSaveSettings(e,l,t,a){var o=new RegExp("^(https?://)([^/]+)(.*)","i"),r=e.href.match(o),n=(r[1],r[2],r[1],e.userAuth.userName,r[2],r[1]+e.userAuth.userName+"@"+r[2]+r[3]),s=e.href,i=transformToServer(l);""!=globalSettings.settingstype.value&&null!=globalSettings.settingstype.value&&("addressbook-home-set"==globalSettings.settingstype.value?s=e.abhref:"calendar-home-set"==globalSettings.settingstype.value&&(s=e.cahref)),$.ajax({type:"PROPPATCH",url:s,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader),l.setRequestHeader("Depth","0")},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:'<?xml version="1.0" encoding="utf-8"?><D:propertyupdate xmlns:D="DAV:"><D:set><D:prop><I:settings xmlns:I="http://inf-it.com/ns/dav/">'+JSON.stringify(i)+"</I:settings></D:prop></D:set></D:propertyupdate>",dataType:"xml",error:function(e,l){console.log("Error: [netSaveSettings: 'PROPPATCH "+n+"'] code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" (this error code usually means network connection error, or your browser is trying to make a cross domain query, but it is not allowed by the destination server or the browser itself)":"")),isAvaible("Settings")&&show_editor_loader_messageSettings("message_error",localization[globalInterfaceLanguage].errSettingsSaved);var t=null;return"undefined"!=typeof globalSettingsSaving&&("event"==globalSettingsSaving?t=$("#CalendarLoader"):"todo"==globalSettingsSaving?t=$("#CalendarLoaderTODO"):"addressbook"==globalSettingsSaving&&(t=$("#AddressbookOverlay"))),null!=t&&(t.addClass("message_error").children(".loaderInfo").text(localization[globalInterfaceLanguage].errCollectionLoad),setTimeout(function(){t.addClass("loader_hidden").removeClass("message_error").children(".loaderInfo").text("")},globalHideInfoMessageAfter)),globalSettingsSaving="",!1},success:function(e,o,r){isAvaible("Settings")&&t?(applySettings(getChangedSettings(globalSettings,l)),globalSettings=l):a&&(checkForLoadedCollections(l),globalSettings=l)}})}function deleteVcalendarFromCollection(e,l,t){(u=e.match(vCalendar.pre.uidParts))[1],u[2],u[3],u[4],u[5];var a=u[1]+u[3]+u[4]+u[5]+u[6],o=u[1]+u[3]+u[4],r=u[2],n=null,s=e.substring(0,e.lastIndexOf("/")+1);if("vevent"==l)var i=globalResourceCalDAVList.collections;else i=globalResourceCalDAVList.TodoCollections;for(var d=vCalendar.pre.accountUidParts,c=0;c<i.length;c++)if(s==i[c].uid){o=(u=i[c].accountUID.match(d))[1]+u[3]+u[4],r=u[2];for(var u,g=0;g<globalAccountSettings.length;g++)globalAccountSettings[g].href==o&&globalAccountSettings[g].userAuth.userName==r&&(n=globalAccountSettings[g]);break}if(null==n)return!1;if("vevent"==l)var b=localization[globalInterfaceLanguage].errUnableDeleteBeginCalDAV;else b=localization[globalInterfaceLanguage].errUnableDeleteTodoBeginCalDAV;new Array;$.ajax({type:"DELETE",url:a,cache:!1,crossDomain:!0,xhrFields:{withCredentials:void 0!==n.withCredentials&&n.withCredentials},timeout:n.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=n.userAuth.userName&&""!=n.userAuth.userPassword&&e.setRequestHeader("Authorization",basicAuth(n.userAuth.userName,n.userAuth.userPassword)),e.setRequestHeader("X-client",globalXClientHeader)},username:1==globalSettings.usejqueryauth.value?n.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?n.userAuth.userPassword:null,contentType:"text/calendar",processData:!0,data:"",dataType:"text",error:function(e,t){switch(console.log("Error: [deleteVcalendarFromCollection: 'DELETE "+a+"']: code: '"+e.status+"' status: '"+t+"'"+(0==e.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.status){case 401:show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].errHttp401));break;case 403:show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].errHttp403));break;case 405:show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].errHttp405));break;case 408:show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].errHttp408));break;case 410:"vevent"==l?show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].CalDAVerrHttp410)):show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].CalDAVerrTodoHttp410));break;case 500:show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].errHttp500));break;default:show_editor_loader_messageCalendar(l,"message_error",b.replace("%%",localization[globalInterfaceLanguage].errHttpCommon.replace("%%",e.status)))}return!1},success:function(a,o,r){if("vevent"==l?globalEventList.removeOldEvent(e,!0,!0):t&&globalEventList.removeOldEvent(e,!0,!1),t)return!0;"vevent"==l?show_editor_loader_messageCalendar("vevent","message_success",localization[globalInterfaceLanguage].txtAllDeleted,function(e){$("#show").val(""),$("#CAEvent").hide(),$("#event_details_template").remove(),$("#CAEvent").append(cleanVcalendarTemplate),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)})}):show_editor_loader_messageCalendar("vtodo","message_success",localization[globalInterfaceLanguage].txtAllDeletedTodo,function(l){$("#showTODO").val(""),$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)}),globalEventList.removeOldEvent(e,!0,!1)})}})}function moveVcalendarToCollection(e,l,t,a,o,r,n,s,i){(new Date).getTime();"vtodo"==r&&(globalTodoLoaderHide=localization[globalInterfaceLanguage].txtAllSavedTodo);hex_sha256(a+(new Date).getTime());for(var d=o.match(vCalendar.pre.uidParts),c=l.match(vCalendar.pre.uidParts),u=c[1]+c[2]+"@"+c[3]+c[4]+c[5],g=d[1]+d[3]+d[4]+d[5]+d[6],b=c[1]+c[3]+c[4]+c[5]+c[6],p=d[4]+d[5]+d[6],v=c[4]+c[5]+c[6],h=null,f=(d=e.match(vCalendar.pre.accountUidParts))[1]+d[3]+d[4],m=d[2],A=0;A<globalAccountSettings.length;A++)globalAccountSettings[A].href==f&&globalAccountSettings[A].userAuth.userName==m&&(h=globalAccountSettings[A]);if(null==h)return!1;if("vevent"==r)var C=localization[globalInterfaceLanguage].errUnableSaveBeginCalDAV;else C=localization[globalInterfaceLanguage].errUnableSaveTodoBeginCalDAV;var D=globalResourceCalDAVList.getEventCollectionByUID(u);null==D&&(D=globalResourceCalDAVList.getTodoCollectionByUID(u));new Array;$.ajax({type:"MOVE",url:g,cache:!1,crossDomain:void 0===h.crossDomain||h.crossDomain,xhrFields:{withCredentials:void 0!==h.withCredentials&&h.withCredentials},timeout:h.timeOut,beforeSend:function(e){1!=globalSettings.usejqueryauth.value&&""!=h.userAuth.userName&&""!=h.userAuth.userPassword&&e.setRequestHeader("Authorization",basicAuth(h.userAuth.userName,h.userAuth.userPassword)),e.setRequestHeader("X-client",globalXClientHeader),e.setRequestHeader("Destination",b)},username:1==globalSettings.usejqueryauth.value?h.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?h.userAuth.userPassword:null,contentType:"text/calendar",processData:!0,data:a,dataType:"text",error:function(e,l){switch(console.log("Error: [moveVcalendarToCollection: 'MOVE from: "+g+" to: "+b+"']: code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.status){case 401:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp401));break;case 403:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp403));break;case 405:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp405));break;case 408:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp408));break;case 412:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp412)),netLoadCalendar(globalResourceCalDAVList.getCollectionByUID(u),[{etag:"",href:p}],null==D.forceSyncPROPFIND||0==D.forceSyncPROPFIND,!1,!0,!0,!0,null,null);break;case 500:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp500));break;default:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttpCommon.replace("%%",e.status)))}return"vtodo"==r&&(globalTodoLoaderHide=""),!$("#InvitationBoxContent").is(":visible")||"vevent"!=r&&"schedule-inbox"!=r||($("#InvitationBoxHeader").find(".invitation_header_item_selected").length?filterInvitations($("#InvitationBoxHeader").find(".invitation_header_item_selected").attr("data-type")):$("#InvitationBoxHeader").find(".invitation_header_item").first().trigger("click")),!1},success:function(e,t,a){globalRevertFunction=null;if(globalWindowFocus=!1,"vevent"==r||"schedule-inbox"==r&&$("#CAEvent").is(":visible")){var i=localization[globalInterfaceLanguage].txtAllSaved;s&&(i=localization[globalInterfaceLanguage].txtAllDeleted),show_editor_loader_messageCalendar(r,"message_success",i,function(e){$("#show").val(""),1!=n&&($("#CAEvent").hide(),$("#calendar").fullCalendar("unselect"),$("#event_details_template").remove(),$("#CAEvent").append(cleanVcalendarTemplate),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)}))}),globalEventList.removeOldEvent(o,!0,!0)}else"vtodo"==r&&globalEventList.removeOldEvent(o,!0,!1);"vevent"==r?netLoadCalendar(globalResourceCalDAVList.getEventCollectionByUID(u),[{etag:"",href:v}],null==D.forceSyncPROPFIND||0==D.forceSyncPROPFIND,!1,!0,!1,!0,null,null):"vtodo"==r&&($("#showTODO").val(l),netLoadCalendar(globalResourceCalDAVList.getTodoCollectionByUID(u),[{etag:"",href:v}],null==D.forceSyncPROPFIND||0==D.forceSyncPROPFIND,!1,!0,!1,!0,null,null)),globalWindowFocus=!0}})}function putVcalendarToCollection(e,l,t,a,o,r,n,s,i){var d=(new Date).getTime();"vtodo"==r&&(globalTodoLoaderHide=localization[globalInterfaceLanguage].txtAllSavedTodo),a=vObjectLineFolding(a);var c=hex_sha256(a+(new Date).getTime()),u=(v=l.match(vCalendar.pre.uidParts))[1]+v[2]+"@"+v[3]+v[4]+v[5];if(""!=t)var g=v[1]+v[3]+v[4]+v[5]+v[6],b=v[4]+v[5]+v[6];else if("/"!=l.charAt(l.length-1))g=v[1]+v[3]+v[4]+v[5]+v[6],b=v[4]+v[5]+v[6];else{var p=c+".ics";g=v[1]+v[3]+v[4]+v[5]+p,b=v[4]+v[5]+p;l+=p}for(var v,h=null,f=(v=e.match(vCalendar.pre.accountUidParts))[1]+v[3]+v[4],m=v[2],A=0;A<globalAccountSettings.length;A++)globalAccountSettings[A].href==f&&globalAccountSettings[A].userAuth.userName==m&&(h=globalAccountSettings[A]);if(null==h)return!1;if("vevent"==r)var C=localization[globalInterfaceLanguage].errUnableSaveBeginCalDAV;else C=localization[globalInterfaceLanguage].errUnableSaveTodoBeginCalDAV;var D=globalResourceCalDAVList.getEventCollectionByUID(u);null==D&&(D=globalResourceCalDAVList.getTodoCollectionByUID(u));new Array;$.ajax({type:"PUT",url:g,cache:!1,crossDomain:void 0===h.crossDomain||h.crossDomain,xhrFields:{withCredentials:void 0!==h.withCredentials&&h.withCredentials},timeout:h.timeOut,beforeSend:function(e){e.setRequestHeader("Prefer","return=representation"),1!=globalSettings.usejqueryauth.value&&""!=h.userAuth.userName&&""!=h.userAuth.userPassword&&e.setRequestHeader("Authorization",basicAuth(h.userAuth.userName,h.userAuth.userPassword)),e.setRequestHeader("X-client",globalXClientHeader),""!=t?e.setRequestHeader("If-Match",t):e.setRequestHeader("If-None-Match","*")},username:1==globalSettings.usejqueryauth.value?h.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?h.userAuth.userPassword:null,contentType:"text/calendar",processData:!0,data:a,dataType:"text",error:function(e,l){switch(console.log("Error: [putVcalendarToCollection: 'PUT "+g+"']: code: '"+e.status+"' status: '"+l+"'"+(0==e.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),e.status){case 401:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp401));break;case 403:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp403));break;case 405:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp405));break;case 408:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp408));break;case 412:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp412)),netLoadCalendar(globalResourceCalDAVList.getCollectionByUID(u),[{etag:"",href:b}],null==D.forceSyncPROPFIND||0==D.forceSyncPROPFIND,!1,!0,!0,!0,null,null);break;case 500:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttp500));break;default:show_editor_loader_messageCalendar(r,"message_error",C.replace("%%",localization[globalInterfaceLanguage].errHttpCommon.replace("%%",e.status)))}return"vevent"==r&&null!=globalRevertFunction?(globalRevertFunction(),globalRevertFunction=null):"vtodo"==r&&(globalTodoLoaderHide="",n&&$("#todoList").fullCalendar("allowSelectEvent",!0)),!1},success:function(c,g,p){if(globalRevertFunction=null,""!=o&&deleteVcalendarFromCollection(o,r,!0),i.length>0){var v=i[0];i.splice(0,1),putVcalendarToCollection(e,l.substring(0,l.lastIndexOf("/")+1),"",v,o,r,n,s,i)}var h=p.getResponseHeader("Etag");if(globalWindowFocus=!1,"vevent"==r){var f=localization[globalInterfaceLanguage].txtAllSaved;s&&(f=localization[globalInterfaceLanguage].txtAllDeleted),show_editor_loader_messageCalendar(r,"message_success",f,function(e){$("#show").val(""),1!=n&&($("#CAEvent").hide(),$("#calendar").fullCalendar("unselect"),$("#event_details_template").remove(),$("#CAEvent").append(cleanVcalendarTemplate),$("#EventDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePicker").prop("disabled",!1)}))})}else null!=h&&(s&&(globalTodoLoaderHide=localization[globalInterfaceLanguage].txtAllDeletedTodo),show_editor_loader_messageCalendar(r,"message_success",globalTodoLoaderHide,function(e){globalTodoLoaderHide="","vtodo"==r&&1!=n&&$("#showTODO").val(""),$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)})}));if(null!=h){var m=l.substring(0,l.lastIndexOf("/")+1);if("vevent"==r){for(var A=globalResourceCalDAVList.collections,C=0;C<A.length;C++)if(m==A[C].uid){if(""==a)return!0;var y=a;"return=representation"==p.getResponseHeader("Preference-Applied")&&p.responseText&&(y=p.responseText);var L=vCalendarCleanup(y);globalEventList.insertEvent(!0,A[C],{isRepeat:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:d,accountUID:A[C].accountUID,uid:l,displayValue:A[C].displayvalue,etag:h,vcalendar:L},!0,!0,!1);break}}else for(A=globalResourceCalDAVList.TodoCollections,C=0;C<A.length;C++)if(m==A[C].uid){if(""==a)return!0;y=a;"return=representation"==p.getResponseHeader("Preference-Applied")&&p.responseText&&(y=p.responseText);L=vCalendarCleanup(y);"vtodo"==r&&1!=n&&$("#showTODO").val(l),globalEventList.insertEvent(!0,A[C],{isRepeat:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:d,accountUID:A[C].accountUID,uid:l,displayValue:A[C].displayvalue,etag:h,vcalendar:L},!0,!1,!1),n&&$("#todoList").fullCalendar("allowSelectEvent",!0),(""==t||n)&&$("#todoList").fullCalendar("selectEvent",$('[data-id="'+l+'"]'));break}}else"vevent"==r?netLoadCalendar(globalResourceCalDAVList.getEventCollectionByUID(u),[{etag:"",href:b}],null==D.forceSyncPROPFIND||0==D.forceSyncPROPFIND,!1,!0,!1,!0,null,null):(n&&$("#todoList").fullCalendar("allowSelectEvent",!0),"vtodo"==r&&1!=n&&$("#showTODO").val(l),netLoadCalendar(globalResourceCalDAVList.getTodoCollectionByUID(u),[{etag:"",href:b}],null==D.forceSyncPROPFIND||0==D.forceSyncPROPFIND,!1,!0,!1,!0,null,null));return globalWindowFocus=!0,!0}})}function CalDAVnetLoadCollection(e,l,t,a,o){if(a>=o.length)return setLoadingLimit(l,t),!globalCalDAVInitLoad&&isCalDAVLoaded&&t&&($("#SystemCalDavZAP .fc-header-center ").removeClass("r_operate_all"),loadNextApplication(!1)),!1;if(o.length>0&&(null!=e.uid&&e.makeLoaded&&e.newlyAdded&&""!=globalSettingsSaving&&updateMainLoaderText(e.listType),null==e.uid||e.subscription||!e.newlyAdded&&!e.syncRequired&&!l&&t||!e.newlyAdded&&!e.someChanged&&!globalCalDAVInitLoad&&t||("vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)&&!e.syncRequired))return e.subscription&&e.syncRequired&&null!=e.uid&&netLoadCalendarSubscription(globalAccountSettings[0],e,a,l,o),++a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(setLoadingLimit(l,t),a=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o),null!=e.uid&&(!e.syncRequired&&globalCalDAVInitLoad?("vtodo"==e.listType?$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"),"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||""==globalLimitLoading&&""==globalLimitTodoLoading?(globalAccountSettings[e.resourceIndex].todoNo--,(0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)):globalCalDAVInitLoad||e.someChanged||("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"))),!1;for(var r,n=e.accountUID.match(vCalendar.pre.accountUidParts),s=n[1]+n[3]+n[4],i=n[2],d=0;d<globalAccountSettings.length;d++)globalAccountSettings[d].href==s&&globalAccountSettings[d].userAuth.userName==i&&globalAccountSettings[d];if(e.makeLoaded&&""==globalSettingsSaving&&updateMainLoaderText(e.listType),null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t||"vevent"!=e.listType||$('#ResourceCalDAVList [data-id="'+e.uid+'"]').addClass("r_operate"),!e.makeLoaded)return"vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):"vtodo"==e.listType&&$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),a++,""==globalLimitLoading&&""==globalLimitTodoLoading||"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value?("vevent"==e.listType?globalAccountSettings[e.resourceIndex].calendarNo--:"vtodo"==e.listType&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad&&updateMainLoader()):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType),a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(a=0,setLoadingLimit(l,t),(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o),!1;if(null!=e.forceSyncPROPFIND&&1==e.forceSyncPROPFIND)var c='<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:"><D:prop><D:getcontenttype/><D:getetag/></D:prop></D:propfind>';else if("vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)c='<?xml version="1.0" encoding="utf-8"?><D:sync-collection xmlns:D="DAV:"><D:prop><D:getcontenttype/><D:getetag/></D:prop><D:sync-level>1</D:sync-level>'+(1==l||null==e.syncToken||""==e.syncToken?"<D:sync-token/>":"<D:sync-token>"+e.syncToken+"</D:sync-token>")+"</D:sync-collection>";else{c="";if(l||e.newlyAdded){if("vevent"==e.listType){globalCalDAVInitLoad&&t&&(null!=globalSettings.eventstartpastlimit.value&&(globalLoadedLimit=new Date,globalLoadedLimit.setDate(1),globalLoadedLimit.setHours(0),globalLoadedLimit.setMinutes(0),globalLoadedLimit.setSeconds(0),globalLoadedLimit.setMilliseconds(0),globalLoadedLimit.setMonth(globalLoadedLimit.getMonth()-globalSettings.eventstartpastlimit.value)),null!=globalSettings.eventstartfuturelimit.value&&(globalToLoadedLimit=new Date,globalToLoadedLimit.setDate(1),globalToLoadedLimit.setHours(0),globalToLoadedLimit.setMinutes(0),globalToLoadedLimit.setSeconds(0),globalToLoadedLimit.setMilliseconds(0),globalToLoadedLimit.setMonth(globalToLoadedLimit.getMonth()+globalSettings.eventstartfuturelimit.value+1)));var u="",g="";if(!e.newlyAdded||globalCalDAVInitLoad){if(null!=globalSettings.eventstartpastlimit.value&&(t||"past"==globalLimitLoading))(b=new Date(globalLoadedLimit.getTime())).setDate(b.getDate()-7),u=t?' start="'+$.fullCalendar.formatDate(b,"yyyyMMdd'T'HHmmss")+'Z"':' start="'+$.fullCalendar.formatDate(b,"yyyyMMdd'T'HHmmss")+'Z" end="'+$.fullCalendar.formatDate(globalBeginPast,"yyyyMMdd'T'HHmmss")+'Z"',a==o.length-1&&(globalBeginPast=new Date(b.getTime()));if(null!=globalSettings.eventstartfuturelimit.value&&(t||"future"==globalLimitLoading))(p=new Date(globalToLoadedLimit.getTime())).setDate(p.getDate()+14),g=t?' end="'+$.fullCalendar.formatDate(p,"yyyyMMdd'T'HHmmss")+'Z"':' start="'+$.fullCalendar.formatDate(globalBeginFuture,"yyyyMMdd'T'HHmmss")+'Z" end="'+$.fullCalendar.formatDate(p,"yyyyMMdd'T'HHmmss")+'Z"',a==o.length-1&&(globalBeginFuture=new Date(p.getTime()))}else{var b=new Date(globalLoadedLimit.getTime()),p=new Date(globalToLoadedLimit.getTime());u=' start="'+$.fullCalendar.formatDate(b,"yyyyMMdd'T'HHmmss")+'Z"',g=' end="'+$.fullCalendar.formatDate(p,"yyyyMMdd'T'HHmmss")+'Z"'}c=t?'<?xml version="1.0" encoding="UTF-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VEVENT"><L:time-range'+u+g+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>":'<?xml version="1.0" encoding="UTF-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VEVENT"><L:time-range'+("past"==globalLimitLoading?u:g)+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>"}else if("vtodo"==e.listType){t&&(null!=globalSettings.todopastlimit.value&&(globalLoadedLimitTodo=new Date,globalLoadedLimitTodo.setDate(1),globalLoadedLimitTodo.setHours(0),globalLoadedLimitTodo.setMinutes(0),globalLoadedLimitTodo.setSeconds(0),globalLoadedLimitTodo.setMilliseconds(0),globalLoadedLimitTodo.setMonth(globalLoadedLimitTodo.getMonth()-globalSettings.todopastlimit.value)),null!=globalSettings.eventstartfuturelimit.value&&(globalToLoadedLimitTodo=new Date,globalToLoadedLimitTodo.setDate(1),globalToLoadedLimitTodo.setHours(0),globalToLoadedLimitTodo.setMinutes(0),globalToLoadedLimitTodo.setSeconds(0),globalToLoadedLimitTodo.setMilliseconds(0),globalToLoadedLimitTodo.setMonth(globalToLoadedLimitTodo.getMonth()+globalSettings.eventstartfuturelimit.value+1)));u="",g="";!e.newlyAdded||globalCalDAVInitLoad?null==globalSettings.todopastlimit.value||!t&&"pastTodo"!=globalLimitTodoLoading||(u=t?' start="'+$.fullCalendar.formatDate(globalLoadedLimitTodo,"yyyyMMdd'T'HHmmss")+'Z"':' start="'+$.fullCalendar.formatDate(globalLoadedLimitTodo,"yyyyMMdd'T'HHmmss")+'Z" end="'+$.fullCalendar.formatDate(new Date(new Date(globalLoadedLimitTodo.getTime()).setMonth(globalLoadedLimitTodo.getMonth()+globalSettings.todopastlimit.value+1)),"yyyyMMdd'T'HHmmss")+'Z"'):u=' start="'+$.fullCalendar.formatDate(globalLoadedLimitTodo,"yyyyMMdd'T'HHmmss")+'Z"',c=t?'<?xml version="1.0" encoding="utf-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VTODO"><L:time-range'+u+g+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>":'<?xml version="1.0" encoding="utf-8"?><L:calendar-query xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop xmlns:D="DAV:"><D:getcontenttype/><D:getetag/><L:calendar-data/></D:prop><L:filter><L:comp-filter name="VCALENDAR"><L:comp-filter name="VTODO"><L:time-range'+("pastTodo"==globalLimitTodoLoading?u:g)+"/></L:comp-filter></L:comp-filter></L:filter></L:calendar-query>"}}else c='<?xml version="1.0" encoding="utf-8"?><D:sync-collection xmlns:D="DAV:"><D:prop><D:getcontenttype/><D:getetag/></D:prop><D:sync-level>1</D:sync-level>'+(1==l||null==e.syncToken||""==e.syncToken?"<D:sync-token/>":"<D:sync-token>"+e.syncToken+"</D:sync-token>")+"</D:sync-collection>"}function v(r,n,s){$('[data-id="'+e.uid+'"]').removeClass("r_error"),"vevent"==e.listType&&0==$("#ResourceCalDAVList").find(".r_error").length&&isEachResourceLoaded()?$("#intCaldav").find(".int_error").css("display","none"):"vtodo"==e.listType&&0==$("#ResourceCalDAVTODOList").find(".r_error").length&&isEachResourceLoaded()&&$("#intCaldavTodo").find(".int_error").css("display","none");var i=e.newlyAdded;e.newlyAdded=!1;var d=new Array,c=!0;if("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value)){var u=0;$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode(new RegExp("^(sync-)?response$")).children().filterNsNode("href").each(function(e,l){u++}),globalResourceCalDAVList.counterList[e.uid+" "+e.listType].collectionLength=u,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].counter=0,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].resourceIndex=e.resourceIndex,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].listType=e.listType,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].typeList=e.typeList}var g=new RegExp("200 OK$"),b=new RegExp("404 Not Found$");if($(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode(new RegExp("^(sync-)?response$")).each(function(t,a){var o=$(a).children().filterNsNode("href").text(),r=$(a).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("getetag").text(),n=!1;if(0!=e.checkContentType){var s=$(a).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("getcontenttype").text();null!=s&&(contenttypeValArr=s.toLowerCase().replace(vCalendar.pre.spaceRex,"").split(";"),-1==contenttypeValArr.indexOf("text/calendar")&&-1==contenttypeValArr.indexOf("text/x-vcalendar")||(n=!0))}else n=!0;var u=$(a).find("*").filterNsNode("status").text(),p=!1;if("/"!=o[o.length-1]&&(1==n&&u.match(g)&&(d[d.length]={etag:r,href:o},p=!0),!p&&u.match(b)&&(d[d.length]={deleted:!0,etag:r,href:o})),(l||i)&&("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))){var v=(new Date).getTime();if(!$(a).children().filterNsNode("propstat").children().filterNsNode("status").text().match(RegExp("200 OK$"))){h=e.uid+o.replace(vCalendar.pre.hrefValRex,"");return console.log("Error: '"+h+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0}var h=e.uid+o.replace(vCalendar.pre.hrefValRex,""),f=$(a).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-data").text();if(""==f)return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;c=!1;var m=vCalendarCleanup(f);if(null==m||null==(check=m.match(vCalendar.pre.vcalendar)))return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),console.log("Error: '"+h+"': unable to parse vCalendar"),!0;if(null!=(check=m.match(vCalendar.pre.vevent)))-1!=e.typeList.indexOf("vevent")?globalEventList.insertEvent(!1,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:v,accountUID:e.accountUID,uid:h,displayValue:e.displayvalue,counter:0,etag:r,vcalendar:m},!1,!0,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1);else{if(null==(check=m.match(vCalendar.pre.vtodo)))return console.log("Error: '"+h+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;-1!=e.typeList.indexOf("vtodo")?globalEventList.insertEvent(!1,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!0,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:v,accountUID:e.accountUID,uid:h,displayValue:e.displayvalue,counter:0,etag:r,vcalendar:m},!1,!1,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1)}}}),!t||l||i||null!=e.forceSyncPROPFIND&&0!=e.forceSyncPROPFIND||(e.syncToken=$(s.responseXML).children().filterNsNode("multistatus").children().filterNsNode("sync-token").text()),("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))&&!c)return e.oldSyncToken=e.syncToken,e.someChanged=!1,o.length>0&&(++a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(setLoadingLimit(l,t),a=0,t&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o),(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)),!1;("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))&&(l&&!t||i&&globalCalDAVInitLoad),netLoadCalendar(e,d,null==e.forceSyncPROPFIND||0==e.forceSyncPROPFIND,!0,l,t,!1,a,o),d=null,"undefined"!=typeof globalParallelAjaxCallCalDAVEnabled&&null!=globalParallelAjaxCallCalDAVEnabled&&globalParallelAjaxCallCalDAVEnabled&&o.length>0&&(++a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(a=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||t)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o))}var h="";"vtodo"==e.listType?h="VTODO":"vevent"==e.listType&&(h="VEVENT"),null!=globalXMLCache&&(r=globalXMLCache.children('caldavcalendarquery[request_url="'+jqueryEscapeSelector(e.url+e.href)+'"][request_component="'+h+'"]').remove()).length?("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&-1!=globalDebug.indexOf("cache")&&console.log("DBG Cache OK: "+arguments.callee.name+" component: "+h+" url: '"+e.url+e.href+"': saved one request!"),v(0,0,{responseXML:r})):("undefined"!=typeof globalDebug&&globalDebug instanceof Array&&-1!=globalDebug.indexOf("cache")&&console.log("DBG Cache ERROR: "+arguments.callee.name+" url: '"+e.url+e.href+"': spend one request!"),$.ajax({type:null!=e.forceSyncPROPFIND&&1==e.forceSyncPROPFIND?"PROPFIND":"REPORT",url:e.url+e.href,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(r){if(1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&r.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),r.setRequestHeader("X-client",globalXClientHeader),r.setRequestHeader("Depth","1"),isAvaible("Settings")&&"visible"==$("#SystemSettings").css("visibility")&&"setting_group_password"==$(".resourceSettings_item_selected").attr("data-type"))return o.length>0&&(++a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(setLoadingLimit(l,t),a=0,(t||null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o)),!1},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml; charset=utf-8",processData:!0,data:c,dataType:"xml",error:function(r,n){return("vtodo"==e.listType&&null!=globalSettings.todopastlimit.value||"vevent"==e.listType&&(null!=globalSettings.eventstartpastlimit.value||null!=globalSettings.eventstartfuturelimit.value))&&null!=r.responseXML&&$(r.responseXML).children().filterNsNode("C:SUPPORTED-FILTER").length>0&&("vevent"==e.listType?(globalSettings.eventstartfuturelimit.value=null,globalSettings.eventstartpastlimit.value=null):globalSettings.todopastlimit.value=null,globalCalendarNumberCount--,CalDAVnetLoadCollection(o[a],l,t,a,o)),400!=r.status&&403!=r.status&&501!=r.status||1==e.forceSyncPROPFIND?(o.length>0&&(++a>=o.length&&"undefined"!=e.uid&&"vevent"==e.listType?(a=0,setLoadingLimit(l,t),(t||null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],l,t,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(o[a],l,t,a,o)),"vevent"==e.listType?($('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldav").find(".int_error").css("display","block")):($('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldavTodo").find(".int_error").css("display","block")),$('[data-id="'+e.uid+'"]').addClass("r_error"),e.syncToken=e.oldSyncToken,""==globalLimitTodoLoading&&""==globalLimitLoading||"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value?("vevent"==e.listType?globalAccountSettings[e.resourceIndex].calendarNo--:"vtodo"==e.listType&&globalAccountSettings[e.resourceIndex].todoNo--,(0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType),console.log("Error: [CalDAVnetLoadCollection: '"+(null!=e.forceSyncPROPFIND&&1==e.forceSyncPROPFIND?"PROPFIND":"REPORT")+" "+e.url+e.href+"'] code: '"+r.status+"' status: '"+n+"'"+(0==r.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),!1):(o[a].forceSyncPROPFIND=!0,"vevent"==e.listType?(globalSettings.eventstartfuturelimit.value=null,globalSettings.eventstartpastlimit.value=null):globalSettings.todopastlimit.value=null,globalCalendarNumberCount--,CalDAVnetLoadCollection(o[a],l,t,a,o),!0)},success:v}))}function netLoadCalendar(e,l,t,a,o,r,n,s,i){var d=new Array,u=(new Date).getTime();if(e.subscription){var g=0;for(c in l)null!=l[c].etag&&null!=l[c].etag&&g++;for(eventUID in globalResourceCalDAVList.counterList[e.uid+" "+e.listType].collectionLength=g,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].counter=0,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].resourceIndex=e.resourceIndex,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].listType=e.listType,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].typeList=e.typeList,0==$(".r_operate_all").length&&$("#SystemCalDavZAP .fc-header-center ").addClass("r_operate_all"),l)if(null!=l[eventUID].etag&&null!=l[eventUID]){var b=l[eventUID].etag,p=(m=l[eventUID].href,l[eventUID].eventText);if(""==p)return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;var v=vCalendarCleanup(p);null!=(check=v.match(vCalendar.pre.vevent))?-1!=e.typeList.indexOf("vevent")?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:m,displayValue:e.displayvalue,counter:0,etag:b,vcalendar:"BEGIN:VCALENDAR"+v+"END:VCALENDAR\r\n"},!1,!0,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1):null!=(check=v.match(vCalendar.pre.vtodo))?-1!=e.typeList.indexOf("vtodo")?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:m,displayValue:e.displayvalue,counter:0,etag:b,vcalendar:"BEGIN:VCALENDAR"+v+"END:VCALENDAR\r\n"},!1,!1,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1):(console.log("Error: '"+m+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1))}return 0==g&&("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),r&&""==globalLimitLoading&&""==globalLimitTodoLoading?(-1!=e.typeList.indexOf("vevent")&&globalAccountSettings[e.resourceIndex].calendarNo--,-1!=e.typeList.indexOf("vtodo")&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)),!1}if(1==t){if("vevent"==e.listType)var h=!0;else h=!1;for(var f=0;f<l.length;f++)1==l[f].deleted?globalEventList.removeOldEvent(e.uid+l[f].href.replace(vCalendar.pre.hrefValRex,""),!0,h):d[d.length]=l[f].href}else{for(f=0;f<l.length;f++){var m=e.uid+l[f].href.replace(vCalendar.pre.hrefValRex,"");globalEventList.checkAndTouchIfExists(e.uid,m,l[f].etag,u)||(d[d.length]=l[f].href)}if("vevent"==e.listType)h=!0;else h=!1;globalEventList.removeOldEvents(e.uid,u,h)}if(null!=s&&null!=i[s]&&null!=i[s].pastUnloaded&&null!=i[s].pastUnloaded&&i[s].pastUnloaded.length>0&&(d=d.concat(i[s].pastUnloaded).sort().unique()),0==d.length)return e.someChanged=!1,e.oldSyncToken=e.syncToken,(o||""!=globalSettingsSaving)&&("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||""==globalLimitLoading&&""==globalLimitTodoLoading?("vevent"==e.listType?globalAccountSettings[e.resourceIndex].calendarNo--:"vtodo"==e.listType&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber||""!=globalSettingsSaving)&&updateMainLoader(!0,e.listType)),("undefined"==typeof globalParallelAjaxCallCalDAVEnabled||null==globalParallelAjaxCallCalDAVEnabled||!globalParallelAjaxCallCalDAVEnabled)&&i.length>0&&(++s>=i.length&&"undefined"!=e.uid&&"vevent"==e.listType?(s=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||r)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],o,r,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(i[s],o,r,s,i)),!0;0==$(".r_operate_all").length&&$("#SystemCalDavZAP .fc-header-center ").addClass("r_operate_all"),multigetData='<?xml version="1.0" encoding="utf-8"?><L:calendar-multiget xmlns:D="DAV:" xmlns:L="urn:ietf:params:xml:ns:caldav"><D:prop><D:getetag/><L:calendar-data/></D:prop><D:href>'+d.join("</D:href><D:href>")+"</D:href></L:calendar-multiget>";$.ajax({type:"REPORT",url:e.url+e.href,cache:!1,crossDomain:void 0===e.crossDomain||e.crossDomain,xhrFields:{withCredentials:void 0!==e.withCredentials&&e.withCredentials},timeout:e.timeOut,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword)),l.setRequestHeader("X-client",globalXClientHeader)},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/xml",processData:!0,data:multigetData,dataType:"xml",error:function(l,t){return null!=s&&null!=e.pastUnloaded&&null!=e.pastUnloaded&&(e.pastUnloaded=d),console.log("Error: [netLoadCalendar: 'REPORT "+e.url+e.href+"'] code: '"+l.status+"' status: '"+t+"'"+(0==l.status?" - see https://www.inf-it.com/"+globalAppName.toLowerCase()+"/readme.txt (cross-domain setup)":"")),"vevent"==e.listType?($('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldav").find(".int_error").css("display","block")):($('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),$("#intCaldavTodo").find(".int_error").css("display","block")),$('[data-id="'+e.uid+'"]').addClass("r_error"),e.syncToken=e.oldSyncToken,"vtodo"==e.listType&&null==globalSettings.todopastlimit.value||"vevent"==e.listType&&null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||""==globalLimitLoading&&""==globalLimitTodoLoading?(-1!=e.listType.indexOf("vevent")?globalAccountSettings[e.resourceIndex].calendarNo--:-1!=e.listType.indexOf("vtodo")&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType),("undefined"==typeof globalParallelAjaxCallCalDAVEnabled||null==globalParallelAjaxCallCalDAVEnabled||!globalParallelAjaxCallCalDAVEnabled)&&i.length>0&&(++s>=i.length&&"undefined"!=e.uid&&"vevent"==e.listType?(s=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||r)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],o,r,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(i[s],o,r,s,i)),!1},success:function(l,t,a){e.someChanged=!1,"vevent"==e.listType&&0==$("#ResourceCalDAVList").find(".r_error").length&&isEachResourceLoaded()?$("#intCaldav").find(".int_error").css("display","none"):"vtodo"==e.listType&&0==$("#ResourceCalDAVTODOList").find(".r_error").length&&isEachResourceLoaded()&&$("#intCaldavTodo").find(".int_error").css("display","none"),e.oldSyncToken=e.syncToken,e.pastUnloaded="";var d=0;$(a.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").children().filterNsNode("href").each(function(e,l){d++}),globalResourceCalDAVList.counterList[e.uid+" "+e.listType].collectionLength=d,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].counter=0,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].resourceIndex=e.resourceIndex,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].listType=e.listType,globalResourceCalDAVList.counterList[e.uid+" "+e.listType].typeList=e.typeList;var c=!0,g=new RegExp("200 OK$");$(a.responseXML).children().filterNsNode("multistatus").children().filterNsNode("response").each(function(l,t){if(!$(t).children().filterNsNode("propstat").children().filterNsNode("status").text().match(g)){o=e.uid+$(t).children().filterNsNode("href").text().replace(vCalendar.pre.hrefValRex,"");return console.log("Error: '"+o+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0}c=!1;var a=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("getetag").text(),o=e.uid+$(t).children().filterNsNode("href").text().replace(vCalendar.pre.hrefValRex,""),r=$(t).children().filterNsNode("propstat").children().filterNsNode("prop").children().filterNsNode("calendar-data").text();if(""==r)return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;var s=vCalendarCleanup(r);if(null==s||null==(check=s.match(vCalendar.pre.vcalendar)))return checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),console.log("Error: '"+o+"': unable to parse vCalendar"),!0;if(null!=(check=s.match(vCalendar.pre.vevent)))-1!=e.typeList.indexOf("vevent")?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:o,displayValue:e.displayvalue,counter:0,etag:a,vcalendar:s},!1,!0,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1);else{if(null==(check=s.match(vCalendar.pre.vtodo)))return console.log("Error: '"+o+"': unable to parse vEvent or vTodo"),checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1),!0;-1!=e.typeList.indexOf("vtodo")?globalEventList.insertEvent(n,e,{threadChange:"",isRepeat:!1,isDrawn:!1,isTODO:!1,untilDate:"",sortStart:"",start:"",end:"",sortkey:"",timestamp:u,accountUID:e.accountUID,uid:o,displayValue:e.displayvalue,counter:0,etag:a,vcalendar:s},!1,!1,!0):checkEventLoader(globalResourceCalDAVList.counterList[e.uid+" "+e.listType],!1)}}),c&&("vevent"==e.listType?$('#ResourceCalDAVList [data-id="'+e.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+e.uid+'"]').removeClass("r_operate"),""==globalLimitLoading&&""==globalLimitTodoLoading?(-1!=e.typeList.indexOf("vevent")?globalAccountSettings[e.resourceIndex].calendarNo--:-1!=e.typeList.indexOf("vtodo")&&globalAccountSettings[e.resourceIndex].todoNo--,0==globalAccountSettings[e.resourceIndex].calendarNo&&0==globalAccountSettings[e.resourceIndex].todoNo&&globalCalDAVInitLoad?updateMainLoader():""!=globalSettingsSaving&&updateMainLoader(!0,e.listType,e.uid)):(globalOnlyCalendarNumber>0&&globalOnlyCalendarNumberCount==globalOnlyCalendarNumber||globalTodoCalendarNumber>0&&globalOnlyTodoCalendarNumberCount==globalTodoCalendarNumber)&&updateMainLoader(!0,e.listType)),("undefined"==typeof globalParallelAjaxCallCalDAVEnabled||null==globalParallelAjaxCallCalDAVEnabled||!globalParallelAjaxCallCalDAVEnabled)&&i.length>0&&(++s>=i.length&&"undefined"!=e.uid&&"vevent"==e.listType?(s=0,(null==globalSettings.eventstartpastlimit.value&&null==globalSettings.eventstartfuturelimit.value||r)&&CalDAVnetLoadCollection(globalResourceCalDAVList.TodoCollections[0],o,r,0,globalResourceCalDAVList.TodoCollections)):CalDAVnetLoadCollection(i[s],o,r,s,i)),""!=globalTodoLoaderHide&&show_editor_loader_messageCalendar("vtodo","message_success",globalTodoLoaderHide,function(e){globalTodoLoaderHide="",$("#showTODO").val(""),$("#TodoDisabler").fadeOut(globalEditorFadeAnimation,function(){$("#timezonePickerTODO").prop("disabled",!1)})})}})}function netLoadCalendarSubscription(e,l,t,a,o){if(!l.makeLoaded||""!=globalLimitLoading||""!=globalLimitTodoLoading)return l.makeLoaded&&updateMainLoaderText(l.listType),"vevent"==l.listType?$('#ResourceCalDAVList [data-id="'+l.uid+'"]').removeClass("r_operate"):$('#ResourceCalDAVTODOList [data-id="'+l.uid+'"]').removeClass("r_operate"),""==globalLimitLoading&&""==globalLimitTodoLoading?(-1!=l.typeList.indexOf("vevent")?globalAccountSettings[l.resourceIndex].calendarNo--:-1!=l.typeList.indexOf("vtodo")&&globalAccountSettings[l.resourceIndex].todoNo--,(0==globalAccountSettings[l.resourceIndex].calendarNo&&0==globalAccountSettings[l.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()):""==globalLimitLoading&&""==globalLimitTodoLoading||updateMainLoader(),!1;$.ajax({type:"GET",url:l.href,cache:!1,crossDomain:!1,timeout:3e4,beforeSend:function(l){1!=globalSettings.usejqueryauth.value&&""!=e.userAuth.userName&&""!=e.userAuth.userPassword&&l.setRequestHeader("Authorization",basicAuth(e.userAuth.userName,e.userAuth.userPassword))},username:1==globalSettings.usejqueryauth.value?e.userAuth.userName:null,password:1==globalSettings.usejqueryauth.value?e.userAuth.userPassword:null,contentType:"text/plain",processData:!0,data:"",dataType:"text",error:function(e,t){return console.log("Error: [netLoadCalendarSubscription: 'GET "+l.href+"'] code: '"+e.status+"' status: '"+t+"'"),"vevent"==l.listType?($('#ResourceCalDAVList [data-id="'+l.uid+'"]').removeClass("r_operate"),$("#intCaldav").find(".int_error").css("display","block")):($('#ResourceCalDAVTODOList [data-id="'+l.uid+'"]').removeClass("r_operate"),$("#intCaldavTodo").find(".int_error").css("display","block")),$('[data-id="'+l.uid+'"]').addClass("r_error"),""==globalLimitLoading&&""==globalLimitTodoLoading&&(-1!=l.typeList.indexOf("vevent")?globalAccountSettings[l.resourceIndex].calendarNo--:-1!=l.typeList.indexOf("vtodo")&&globalAccountSettings[l.resourceIndex].todoNo--,(0==globalAccountSettings[l.resourceIndex].calendarNo&&0==globalAccountSettings[l.resourceIndex].todoNo&&globalCalDAVInitLoad||!globalCalDAVInitLoad)&&updateMainLoader()),!1},success:function(e,r,n){"vevent"==l.listType&&0==$("#ResourceCalDAVList").find(".r_error").length&&isEachResourceLoaded()?$("#intCaldav").find(".int_error").css("display","none"):"vtodo"==l.listType&&0==$("#ResourceCalDAVTODOList").find(".r_error").length&&isEachResourceLoaded()&&$("#intCaldavTodo").find(".int_error").css("display","none");var s=vCalendarCleanup(n.responseText);if(l.urlArray={},l.newlyAdded=!1,-1!=l.typeList.indexOf("vevent")){var i=0,d=!1;for(null!=s.match(vCalendar.pre.vevent)&&(d=!0);null!=s.match(vCalendar.pre.vevent);){null!=(b=(g=s.substring(s.indexOf("BEGIN:VEVENT")-2,s.indexOf("END:VEVENT")+"END:VEVENT".length)).match(vCalendar.pre.contentline_UID))&&(b=(b=b[0].match(vCalendar.pre.contentline_parse)[4]).replace("/",""));var c=hex_sha256(g);null!=l.urlArray&&(null!=l.urlArray[l.uid+b+".ics"]&&null!=l.urlArray[l.uid+b+".ics"]?l.urlArray[l.uid+b+".ics"].eventText+=g+"\r\n":l.urlArray[l.uid+b+".ics"]={etag:c,href:l.uid+b+".ics",eventText:g+"\r\n"}),s=s.replace(g,""),i++}0==i&&d&&(void 0===b||null==b?console.log("Error: '"+l.uid+"': unable to parse subscribed vEvent"):console.log("Error: '"+l.uid+b+".ics': unable to parse subscribed vEvent"))}if(-1!=l.typeList.indexOf("vtodo")){i=0;var u=!1;for(null!=s.match(vCalendar.pre.vtodo)&&(u=!0);null!=s.match(vCalendar.pre.vtodo);){var g,b;null!=(b=(g=s.substring(s.indexOf("BEGIN:VTODO")-2,s.indexOf("END:VTODO")+"END:VTODO".length)).match(vCalendar.pre.contentline_UID))&&(b=(b=b[0].match(vCalendar.pre.contentline_parse)[4]).replace("/",""));c=hex_sha256(g);null!=l.urlArray&&(null!=l.urlArray[l.uid+b+".ics"]&&null!=l.urlArray[l.uid+b+".ics"]?l.urlArray[l.uid+b+".ics"].eventText+=g+"\r\n":l.urlArray[l.uid+b+".ics"]={etag:c,href:l.uid+b+".ics",eventText:g+"\r\n"}),s=s.replace(g,""),i++}0==i&&u&&(void 0===b||null==b?console.log("Error: '"+l.uid+"': unable to parse subscribed vTodo"):console.log("Error: '"+l.uid+b+".ics': unable to parse subscribed vTodo"))}if(void 0!==globalEventList.events[l.uid])for(event in globalEventList.events[l.uid])null!=l.urlArray[event]&&null!=l.urlArray[event]||globalEventList.removeOldEvent(event,!0,!0);else for(event in globalEventList.todos[l.uid])null!=l.urlArray[event]&&null!=l.urlArray[event]||globalEventList.removeOldEvent(event,!0,!1);netLoadCalendar(l,l.urlArray,null==l.forceSyncPROPFIND||0==l.forceSyncPROPFIND,!0,a,!0,!1,t,o)}})}